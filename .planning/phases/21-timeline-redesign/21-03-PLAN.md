---
phase: 21-timeline-redesign
plan: 03
type: execute
wave: 3
depends_on: [21-02]
files_modified: [src/components/timeline/Timeline.tsx, src/components/timeline/TimelineContainer.tsx, src/components/timeline/TimelineBrush.tsx]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Timeline orchestrates data and interaction"
    - "Brush handles user input"
    - "Container handles responsiveness"
  artifacts:
    - path: "src/components/timeline/Timeline.tsx"
      provides: "Main component"
    - path: "src/components/timeline/TimelineBrush.tsx"
      provides: "Interaction"
  key_links:
    - from: "src/components/timeline/Timeline.tsx"
      to: "src/components/timeline/layers/HistogramLayer.tsx"
      via: "import"
---

<objective>
Assemble the core Timeline component with state management and interaction.

Purpose: Connect visual layers with user input and data state.
Output: The main `Timeline` component and its interactive brush.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/components/timeline/layers/HistogramLayer.tsx
@src/utils/timeline-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Timeline Container</name>
  <files>src/components/timeline/TimelineContainer.tsx</files>
  <action>
    Create a wrapper component using `@visx/responsive` `ParentSize`.
    It should accept `children` (function of `{ width, height }`) and render them.
    Style: Full width, fixed height (e.g., 200px or prop).
  </action>
  <verify>
    File exists and imports ParentSize.
  </verify>
  <done>
    Container handles sizing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Timeline Brush</name>
  <files>src/components/timeline/TimelineBrush.tsx</files>
  <action>
    Create a component using `@visx/brush`.
    Props: `scale`, `margin`, `onChange`.
    Handle brush events to call `onChange` with the selected domain.
    Style the brush selection and handles for visibility.
  </action>
  <verify>
    File exists and imports Brush.
  </verify>
  <done>
    Brush component exists.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Main Timeline Component</name>
  <files>src/components/timeline/Timeline.tsx</files>
  <action>
    Create `src/components/timeline/Timeline.tsx`.
    
    State:
    - `viewMode`: 'histogram' | 'markers'
    - `filteredDomain`: [Date, Date]
    
    Props:
    - `data`: Raw data array
    - `onChange`: Callback for time selection
    
    Logic:
    - Use `useMemo` to compute scales (`scaleTime`, `scaleLinear`).
    - Use `timeline-utils` to bin data if in histogram mode.
    
    Render:
    - `TimelineContainer` -> SVG.
    - Switch between `HistogramLayer` and `MarkerLayer` based on `viewMode`.
    - Overlay `TimelineBrush`.
    - Add `AxisLayer`.
    - Add a small toggle button (outside SVG) to switch view modes.
  </action>
  <verify>
    Component compiles and imports all layers.
  </verify>
  <done>
    Timeline logic is complete.
  </done>
</task>

</tasks>

<verification>
Ensure Timeline renders without crashing (mock data check if possible).
</verification>

<success_criteria>
- Timeline component assembles layers.
- Interaction wiring is ready.
</success_criteria>

<output>
After completion, create `.planning/phases/21-timeline-redesign/21-03-SUMMARY.md`
</output>
