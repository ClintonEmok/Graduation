---
phase: 21-timeline-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, src/utils/timeline-utils.ts, src/components/ui/mobile-blocker.tsx]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Visx dependencies are installed"
    - "Data binning utility exists and works"
    - "Mobile blocker component is created"
  artifacts:
    - path: "src/utils/timeline-utils.ts"
      provides: "Histogram binning logic"
      exports: ["binTimeData"]
    - path: "src/components/ui/mobile-blocker.tsx"
      provides: "Mobile overlay"
  key_links:
    - from: "src/utils/timeline-utils.ts"
      to: "d3-array"
      via: "import"
---

<objective>
Establish the foundation for the new timeline by installing dependencies and creating utility functions.

Purpose: Provide necessary tools and responsiveness guards before building the complex UI.
Output: Installed packages, utility module, and mobile blocking component.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@src/hooks/useCrimeStream.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Visx Dependencies</name>
  <files>package.json</files>
  <action>
    Install the following packages using npm:
    - @visx/brush
    - @visx/shape
    - @visx/responsive
    - @visx/scale
    - @visx/axis (ensure version match)
    
    Ensure types are installed if needed (usually included in modern libs, but check).
  </action>
  <verify>
    npm list @visx/brush
  </verify>
  <done>
    Packages listed in package.json and node_modules.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Timeline Utilities</name>
  <files>src/utils/timeline-utils.ts</files>
  <action>
    Create `src/utils/timeline-utils.ts`.
    Implement `binTimeData<T>(data: T[], accessor: (d: T) => Date | number, options: { domain: [number, number], threshold: number })`.
    Use `d3-array`'s `bin` function.
    Ensure it handles empty data gracefully.
    Export types for BinnedData.
  </action>
  <verify>
    Create a small test script or use node to import and test binning with dummy data.
  </verify>
  <done>
    Function exports correct bin structure.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Mobile Blocker</name>
  <files>src/components/ui/mobile-blocker.tsx</files>
  <action>
    Create a component that:
    - Is `fixed inset-0 z-50 bg-background`.
    - Contains a message: "Please use a larger screen to view this visualization."
    - Is visible ONLY on small screens (`block md:hidden`).
    - Uses Tailwind classes.
  </action>
  <verify>
    Verify file creation and class names.
  </verify>
  <done>
    Component exists with correct visibility classes.
  </done>
</task>

</tasks>

<verification>
Check that `npm install` succeeded.
Check that `src/utils/timeline-utils.ts` compiles.
</verification>

<success_criteria>
- Visx libs installed.
- Utils created.
- Mobile blocker created.
</success_criteria>

<output>
After completion, create `.planning/phases/21-timeline-redesign/21-01-SUMMARY.md`
</output>
