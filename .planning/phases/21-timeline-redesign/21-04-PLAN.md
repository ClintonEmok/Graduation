---
phase: 21-timeline-redesign
plan: 04
type: execute
wave: 4
depends_on: [21-03]
files_modified: [src/components/timeline/TimelinePanel.tsx, src/components/timeline/index.ts, src/app/layout.tsx]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "New Timeline is visible in the UI"
    - "Mobile blocker works on small screens"
    - "Selection works (no single point bug)"
  artifacts:
    - path: "src/components/timeline/TimelinePanel.tsx"
      provides: "Integration point"
  key_links:
    - from: "src/components/timeline/TimelinePanel.tsx"
      to: "src/components/timeline/Timeline.tsx"
      via: "Composition"
---

<objective>
Integrate the new Timeline into the application and enforce mobile constraints.

Purpose: Finalize the redesign by replacing the old component and adding guardrails.
Output: Integrated, working timeline in the app.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/components/timeline/Timeline.tsx
@src/components/timeline/TimelinePanel.tsx
@src/components/ui/mobile-blocker.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Mobile Blocker</name>
  <files>src/app/layout.tsx</files>
  <action>
    Import `MobileBlocker` in `src/app/layout.tsx` (or the root layout).
    Place it at the top level.
    Ensure `MobileBlocker` has `md:hidden` and the main `children` or wrapper gets `hidden md:block` (or similar logic) to hide app content when blocked.
    *Correction*: Just overlaying with z-index is enough if it's opaque.
  </action>
  <verify>
    Check file modification.
  </verify>
  <done>
    Blocker added.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Timeline Panel</name>
  <files>src/components/timeline/TimelinePanel.tsx</files>
  <action>
    Modify `TimelinePanel.tsx`.
    Import the new `Timeline` component.
    Replace `<DualTimeline />` with `<Timeline />`.
    
    Data Wiring:
    - Get data from `useTimeStore` or `useCrimeStream` (check where DualTimeline got it).
    - If `DualTimeline` used `useTimeStore` implicitly, ensure `Timeline` receives necessary props or connects to store.
    
    Interaction Wiring:
    - Pass `onChange` prop to `Timeline`.
    - implementation: `(domain) => { setTimeWindow(domain); }` or similar store update.
    - Ensure it handles the "range" vs "single point" logic correctly (updating `currentTime` vs `timeWindow`).
  </action>
  <verify>
    Panel compiles with new component.
  </verify>
  <done>
    Old timeline replaced.
  </done>
</task>

<task type="auto">
  <name>Task 3: Export and Cleanup</name>
  <files>src/components/timeline/index.ts</files>
  <action>
    Update `src/components/timeline/index.ts` to export `Timeline`.
    Remove exports for `DualTimeline` if appropriate.
    (Optional) Delete `DualTimeline.tsx` if strictly replaced, otherwise rename to `_deprecated_DualTimeline.tsx`.
  </action>
  <verify>
    Index file updated.
  </verify>
  <done>
    Clean interface.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>New Timeline Redesign</what-built>
  <how-to-verify>
    1. Open app on desktop: See timeline at bottom.
    2. Toggle between Histogram/Markers.
    3. Brush to select a range -> Map should update.
    4. Resize window -> Timeline resizes.
    5. Open devtools device mode (mobile) -> See "Please use larger screen" message.
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass</resume-signal>
</task>

</tasks>

<verification>
Full integration check via checkpoint.
</verification>

<success_criteria>
- Old timeline gone.
- New timeline working.
- Mobile blocked.
</success_criteria>

<output>
After completion, create `.planning/phases/21-timeline-redesign/21-04-SUMMARY.md`
</output>
