---
phase: 24-interaction-synthesis-debugging
plan: 03
type: execute
wave: 3
depends_on: [24-02]
files_modified: [src/hooks/useSelectionSync.ts, src/components/viz/MainScene.tsx]
autonomous: true
must_haves:
  truths:
    - "Selecting in Map updates 3D view"
    - "Selecting in 3D updates Map"
    - "Timeline scrolls to selection"
  artifacts:
    - path: "src/hooks/useSelectionSync.ts"
      provides: "Sync logic"
  key_links:
    - from: "src/components/viz/MainScene.tsx"
      to: "src/hooks/useSelectionSync.ts"
      via: "Usage"
---

<objective>
Implement the "Conductor" logic to sync all views.
Purpose: Tie the specialized stores together using `CoordinationStore`.
Output: A seamless multi-view experience.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/store/useCoordinationStore.ts
@src/store/useTimeStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Sync Hook</name>
  <files>src/hooks/useSelectionSync.ts</files>
  <action>
    Create `src/hooks/useSelectionSync.ts`.
    
    Logic:
    - Listen to `selectedIndex` from `useCoordinationStore`.
    - When it changes:
      1. Get point data (time) for that index.
      2. Update `useTimeStore` to center/scroll to that time (if "Scroll/Zoom" is desired).
      3. Update `useSliceStore` active slice (if point is inside a slice, open panel).
    
    - Listen to `timeRange` (brush) from `useTimeStore`.
    - When it changes (debounced):
      1. Broadcast range to shaders (already done via uniforms in Plan 02, but maybe store update needed?).
      2. No store update needed if `DataPoints` reads directly.
  </action>
  <verify>
    Hook created.
  </verify>
  <done>Sync logic active.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Sync Hook</name>
  <files>src/components/viz/MainScene.tsx</files>
  <action>
    Use `useSelectionSync` in `MainScene.tsx` (or a top-level component that is always mounted).
    Ensure it runs once.
  </action>
  <verify>
    Import added.
  </verify>
  <done>System connected.</done>
</task>

</tasks>

<verification>
- Click Map -> Timeline moves.
- Click 3D -> Timeline moves.
</verification>

<success_criteria>
- All views stay in sync.
</success_criteria>

<output>
After completion, create `.planning/phases/24-interaction-synthesis-debugging/24-03-SUMMARY.md`
</output>
