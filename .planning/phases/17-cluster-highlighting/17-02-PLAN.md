---
phase: 17-cluster-highlighting
plan: 02
type: execute
wave: 2
depends_on: [17-01]
files_modified: [src/components/viz/ClusterHighlights.tsx, src/components/viz/ClusterLabels.tsx]
autonomous: true

must_haves:
  truths:
    - "System renders bounding indicators around clusters"
    - "Billboarded labels face the camera and show cluster stats"
  artifacts:
    - path: "src/components/viz/ClusterHighlights.tsx"
      provides: "3D wireframe boxes for clusters"
    - path: "src/components/viz/ClusterLabels.tsx"
      provides: "HTML/HUD labels for clusters"
---

<objective>
Implement the 3D visualization for clusters, including bounding boxes and informative labels.

Purpose: To provide visual feedback to the user about detected clusters.
Output: Two new 3D components for highlights and labels.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/17-cluster-highlighting/17-01-SUMMARY.md
@src/store/useClusterStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cluster Highlights (Boxes)</name>
  <files>src/components/viz/ClusterHighlights.tsx</files>
  <action>
    1. Create `ClusterHighlights` component that reads `clusters` and `enabled` from `useClusterStore`.
    2. Render an `InstancedMesh` (or individual meshes if count is low) of boxes.
    3. Use wireframe material for the box outline and a very subtle transparent material (10% opacity) for the volume.
    4. Color each box based on its `dominantType` color.
  </action>
  <verify>Check that 3D boxes appear around dense areas in the Cube (ensure the component is added to MainScene/CubeVisualization in the next plan or do it now for testing).</verify>
  <done>Clusters are visually represented by 3D bounding boxes.</done>
</task>

<task type="auto">
  <name>Task 2: Cluster Labels (HUD)</name>
  <files>src/components/viz/ClusterLabels.tsx</files>
  <action>
    1. Create `ClusterLabels` component using `<Html>` from `@react-three/drei`.
    2. Sort clusters by density (count) and select the Top 5 for labeling.
    3. Render a badge-style label at the center-top of each cluster box.
    4. Content: "[Dominant Type]: [Count]" (e.g., "Theft: 24").
    5. Add a thin leader line (THREE.Line or simple CSS border) connecting the label to the cluster center.
  </action>
  <verify>Check that labels appear above the top 5 clusters and face the camera during rotation.</verify>
  <done>Top clusters are labeled with density information.</done>
</task>

</tasks>

<verification>
Ensure that both boxes and labels are visible and correctly positioned relative to the data points.
</verification>

<success_criteria>
- ClusterHighlights renders wireframe boxes for all clusters.
- ClusterLabels renders HTML badges for the top 5 densest clusters.
- Visuals update when clusters are recalculated.
</success_criteria>

<output>
After completion, create `.planning/phases/17-cluster-highlighting/17-02-SUMMARY.md`
</output>
