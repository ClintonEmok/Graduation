---
phase: 22-contextual-slice-analysis
plan: 02
type: execute
wave: 2
depends_on: [22-01]
files_modified: [src/components/viz/ContextualSlicePanel.tsx, src/components/viz/SliceStats.tsx]
autonomous: true
must_haves:
  truths:
    - "Panel slides in when slice is active"
    - "Stats are visualized (Bar charts)"
    - "Empty state handles no data"
  artifacts:
    - path: "src/components/viz/ContextualSlicePanel.tsx"
      provides: "Panel container"
    - path: "src/components/viz/SliceStats.tsx"
      provides: "Visualizations"
  key_links:
    - from: "src/components/viz/ContextualSlicePanel.tsx"
      to: "src/store/useSliceStore.ts"
      via: "activeSliceId"
---

<objective>
Implement the UI components for the contextual analysis panel.
Purpose: Visualize the data calculated in Plan 01.
Output: A functional slide-in panel with charts.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/hooks/useSliceStats.ts
@src/store/useSliceStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Stats Visualization</name>
  <files>src/components/viz/SliceStats.tsx</files>
  <action>
    Create `src/components/viz/SliceStats.tsx`.
    
    Props: `sliceId: string`
    
    Logic:
    - Call `useSliceStats(sliceId)`.
    - If `isLoading`, show Skeleton.
    - If `totalCount === 0`, show "No Data" state.
    - If data exists, render Bar Charts for:
      - Top Crime Types
      - Top Districts
    - Use `@visx/shape` `Bar` for custom charts or a simple HTML/CSS bar if preferred for simplicity. Given the "standard stack" research, Visx is preferred but HTML bars (`div` with width %) are often cleaner for simple lists.
    - Decision: Use simple HTML bars for "Top N" lists (easier to style labels).
  </action>
  <verify>
    Component compiles.
  </verify>
  <done>Stats component creates charts.</done>
</task>

<task type="auto">
  <name>Task 2: Create Panel Container</name>
  <files>src/components/viz/ContextualSlicePanel.tsx</files>
  <action>
    Create `src/components/viz/ContextualSlicePanel.tsx`.
    
    Logic:
    - Subscribe to `activeSliceId` from `useSliceStore`.
    - If `activeSliceId` is null, render nothing (or slide out).
    - If active, render a fixed sidebar on the right (`fixed right-0 top-0 h-full w-80`).
    - Include "Close" button (`setActiveSlice(null)`).
    - Render `SliceStats` with the active ID.
    - Style with Tailwind (bg-background, border-l, shadow-xl).
  </action>
  <verify>
    Component created.
  </verify>
  <done>Panel exists and connects to store.</done>
</task>

</tasks>

<verification>
- Panel compiles.
- Stats visualizer compiles.
</verification>

<success_criteria>
- Panel appears when state changes.
- Stats show up.
</success_criteria>

<output>
After completion, create `.planning/phases/22-contextual-slice-analysis/22-02-SUMMARY.md`
</output>
