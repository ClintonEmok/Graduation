---
phase: 22-contextual-slice-analysis
plan: 03
type: execute
wave: 3
depends_on: [22-02]
files_modified: [src/app/page.tsx, src/components/viz/PointInspector.tsx, src/components/viz/ContextualSlicePanel.tsx]
autonomous: true
must_haves:
  truths:
    - "Panel is integrated into main layout"
    - "Clicking a point in 3D selects it in panel"
    - "Clicking an item in panel highlights it in 3D"
  artifacts:
    - path: "src/components/viz/PointInspector.tsx"
      provides: "Individual point details"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/viz/ContextualSlicePanel.tsx"
      via: "Composition"
---

<objective>
Integrate the panel into the main application and enable bidirectional point interaction.
Purpose: Connect the isolated panel to the 3D scene and layout.
Output: Fully functional analysis workflow.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/components/viz/ContextualSlicePanel.tsx
@src/store/useSliceStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Point Inspector</name>
  <files>src/components/viz/PointInspector.tsx</files>
  <action>
    Create `src/components/viz/PointInspector.tsx`.
    
    Logic:
    - Display details for a selected point (passed as prop or ID).
    - Show: Type, District, Timestamp, Block.
    - Add "Back to Stats" button if we implement drill-down.
    - Decision: Embed this *inside* the `ContextualSlicePanel` (below stats or as a toggle). For now, list top points in the stats view and allow clicking them to expand details.
  </action>
  <verify>
    Component created.
  </verify>
  <done>Inspector exists.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Panel into Layout</name>
  <files>src/app/page.tsx</files>
  <action>
    Import `ContextualSlicePanel` in `src/app/page.tsx` (or `MainScene`).
    Place it outside the Canvas but inside the main container.
    Ensure z-index puts it above the map/scene.
  </action>
  <verify>
    File modified.
  </verify>
  <done>Panel is in the render tree.</done>
</task>

<task type="auto">
  <name>Task 3: Connect 3D Interaction</name>
  <files>src/components/viz/DataPoints.tsx, src/components/viz/TimeSlices.tsx</files>
  <action>
    Update interaction logic:
    - In `DataPoints.tsx` (or wherever points render), add `onClick` handler.
    - If a point inside an active slice is clicked, set it as "inspected point" (might need a new field in store `inspectedPointId`).
    - Update `ContextualSlicePanel` to show `PointInspector` when a point is selected.
  </action>
  <verify>
    Check onClick handlers.
  </verify>
  <done>3D clicks drive panel state.</done>
</task>

</tasks>

<verification>
- Panel appears.
- Point selection works bi-directionally.
</verification>

<success_criteria>
- Analysis workflow is complete.
- User can go from Slice -> Stats -> Point.
</success_criteria>

<output>
After completion, create `.planning/phases/22-contextual-slice-analysis/22-03-SUMMARY.md`
</output>
