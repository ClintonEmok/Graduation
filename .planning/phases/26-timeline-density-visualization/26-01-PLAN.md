---
phase: 26-timeline-density-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/timeline-test/page.tsx
  - src/components/timeline/DensityAreaChart.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - Test route `/timeline-test` renders a working page
    - DensityAreaChart displays event density as gradient-filled area
    - Area chart has 72px height with proper scaling
    - Gradient shows density variation (blue to transparent fade)
    - Component renders without errors on test page
  artifacts:
    - path: "src/app/timeline-test/page.tsx"
      provides: "Test route page"
      min_lines: 50
      exports: ["default"]
    - path: "src/components/timeline/DensityAreaChart.tsx"
      provides: "Area chart component"
      min_lines: 100
      exports: ["DensityAreaChart"]
  key_links:
    - from: "DensityAreaChart"
      to: "@visx/shape AreaClosed"
      via: "Visx import"
      pattern: "import.*AreaClosed.*@visx/shape"
    - from: "DensityAreaChart"
      to: "@visx/gradient LinearGradient"
      via: "Gradient import"
      pattern: "import.*LinearGradient.*@visx/gradient"
---

<objective>
Create test route and DensityAreaChart component for timeline density visualization.

Purpose: Establish isolated testing environment and build the primary density visualization component using Visx area chart with gradient fills. This is the foundation for timeline density visualization that will be integrated in subsequent plans.
Output: Working test route at `/timeline-test` with functional DensityAreaChart component.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/26-timeline-density-visualization/26-CONTEXT.md
@.planning/phases/26-timeline-density-visualization/26-RESEARCH.md
@.planning/REQUIREMENTS.md
@/Users/clintonemok/.local/share/opencode/worktree/d0fbfb0ff8df08417c3b1ad31fe4adc5da685c10/quiet-tiger/src/components/timeline/DensityTrack.tsx
@/Users/clintonemok/.local/share/opencode/worktree/d0fbfb0ff8df08417c3b1ad31fe4adc5da685c10/quiet-tiger/src/store/useAdaptiveStore.ts
@/Users/clintonemok/.local/share/opencode/worktree/d0fbfb0ff8df08417c3b1ad31fe4adc5da685c10/quiet-tiger/src/components/timeline/DualTimeline.tsx
@/Users/clintonemok/.local/share/opencode/worktree/d0fbfb0ff8df08417c3b1ad31fe4adc5da685c10/quiet-tiger/package.json
</context>

<tasks>

<task type="auto">
  <name>Install @visx/gradient package</name>
  <files>package.json</files>
  <action>
    Install @visx/gradient package using npm. This is required for gradient fills in the area chart.
    
    Run: `npm install @visx/gradient`
    
    Verify it appears in dependencies with version 3.12.0 (matching other @visx packages).
    
    Note: Do NOT use --save flag explicitly - npm adds to dependencies automatically in modern versions.
  </action>
  <verify>
    Check package.json contains: `"@visx/gradient": "^3.12.0"`
    Run: `grep '"@visx/gradient"' package.json`
  </verify>
  <done>@visx/gradient is installed and listed in package.json dependencies</done>
</task>

<task type="auto">
  <name>Create DensityAreaChart component</name>
  <files>src/components/timeline/DensityAreaChart.tsx</files>
  <action>
    Create the DensityAreaChart component using Visx primitives.
    
    **Requirements from RESEARCH.md:**
    - Use @visx/shape AreaClosed for the area path
    - Use @visx/gradient LinearGradient for gradient fill
    - Use @visx/scale scaleTime and scaleLinear for axes
    - Use curveMonotoneX for smooth curves
    - Height: 72px (6 Tailwind spacing units)
    - Gradient: blue (#3b82f6) with fromOpacity=0.5 to toOpacity=0.05
    - Stroke: same blue with opacity 0.6 and width 1.5px
    - Visual-only (no Y-axis labels)
    - Handle devicePixelRatio for crisp rendering
    
    **Interface:**
    ```typescript
    interface DensityPoint {
      time: Date;
      density: number;
    }
    
    interface DensityAreaChartProps {
      data: DensityPoint[];
      width: number;
      height?: number; // default 72
      margin?: { top: number; right: number; bottom: number; left: number };
    }
    ```
    
    **Implementation details:**
    - Use useMemo for xScale and yScale
    - yScale domain: [0, maxDensity] with range [innerHeight, 0] (inverted for SVG)
    - Place LinearGradient in SVG <defs> with unique ID
    - Apply margin with g transform
    - Use stroke for outline visibility
    - Zero/null handling: render minimum-height line with low opacity
    
    **Reference existing pattern:**
    Look at how DualTimeline.tsx uses scales and margins.
  </action>
  <verify>
    Component compiles without TypeScript errors.
    Run: `npx tsc --noEmit src/components/timeline/DensityAreaChart.tsx 2>&1 | head -20`
  </verify>
  <done>
    - Component file exists and exports DensityAreaChart
    - Uses @visx/shape, @visx/gradient, @visx/scale
    - Has proper TypeScript interfaces
    - Default height is 72px
    - Gradient defined in SVG defs
  </done>
</task>

<task type="auto">
  <name>Create timeline-test route page</name>
  <files>src/app/timeline-test/page.tsx</files>
  <action>
    Create a standalone test route at `/timeline-test` to isolate density visualization development.
    
    **Page requirements:**
    - Self-contained, no dependencies on main app layout
    - Loads sample/mock density data for testing
    - Renders DensityAreaChart at full container width
    - Shows both the area chart and the existing DensityTrack for comparison
    - Responsive container using useMeasure or ParentSize
    
    **Structure:**
    ```tsx
    export default function TimelineTestPage() {
       // Generate sample density data (mock)
       // Use useMeasure for responsive width
       // Render DensityAreaChart with sample data
       // Render DensityTrack below for comparison
    }
    ```
    
    **Sample data generation:**
    Generate 100-200 density points with:
    - Time range spanning several hours/days
    - Density values with clear high/low regions for visual testing
    - Use Float32Array and convert to DensityPoint[] format
    
    **Layout:**
    - Full width container with padding
    - Title: "Timeline Density Visualization Test"
    - Section for Area Chart (72px + margins)
    - Section for Heat Strip (12px DensityTrack)
    - Info text explaining what's being tested
    
    **Accessing adaptive store data:**
    Connect to useAdaptiveStore to get real densityMap if available, with fallback to mock data.
  </action>
  <verify>
    Page compiles and route is accessible.
    Run dev server and visit: http://localhost:3000/timeline-test
    Verify: Page loads without errors, both visualizations appear.
  </verify>
  <done>
    - Test route `/timeline-test` is accessible
    - Renders DensityAreaChart with sample data
    - Shows gradient-filled area chart at 72px height
    - Displays density variation clearly (high vs low areas visible)
    - No console errors
  </done>
</task>

</tasks>

<verification>
[ ] Navigate to `/timeline-test` - page loads without errors
[ ] Area chart renders with gradient fill (blue to transparent)
[ ] Chart shows clear density variation (visible peaks and valleys)
[ ] Chart height is 72px as specified
[ ] Heat strip (DensityTrack) renders below for comparison
[ ] Component uses @visx/shape and @visx/gradient
[ ] TypeScript compilation succeeds
</verification>

<success_criteria>
1. **DENS-01 (Partial):** Timeline renders event density as clear visual regions - Area chart shows density as gradient-filled region
2. **DENS-02 (Partial):** High-density areas visually distinct - Gradient height makes density variation visible
3. Test route operational for iterative development
4. DensityAreaChart component ready for timeline integration
</success_criteria>

<output>
After completion, create `.planning/phases/26-timeline-density-visualization/26-01-SUMMARY.md`

Include:
- Component API documentation
- Sample data format used
- Any deviations from RESEARCH.md recommendations
- Screenshots or visual notes if available
</output>
