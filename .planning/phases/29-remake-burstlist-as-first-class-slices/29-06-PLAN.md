---
phase: 29-remake-burstlist-as-first-class-slices
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/timeline/DualTimeline.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Burst window rects receive pointer events and can be clicked"
    - "Clicking a burst window on the timeline creates a new time slice with matching range"
    - "Zoom/pan overlay still functions correctly (zoom by drag, pan by wheel)"
    - "All other timeline interactions (slice overlays, handles) continue to work"
  artifacts:
    - path: "src/components/timeline/DualTimeline.tsx"
      provides: "Timeline with correct SVG render order for burst interactions"
      changes:
        - "Reorder SVG element rendering so burst windows appear AFTER zoom overlay"
        - "Burst windows rendered at z-index level above zoom overlay (via SVG document order)"
        - "Ensure burst window rects have pointer-events: all (or auto) for click handling"
        - "Verify zoom overlay uses appropriate pointer-events value (none or auto)"
  key_links:
    - from: "DualTimeline.tsx burst window rects"
      to: "onBurstWindowClick handler"
      via: "onClick event binding on rect elements"
      pattern: "onClick.*burstWindow|onBurstWindowClick"
    - from: "SVG render order"
      to: "pointer event capture"
      via: "burst rects rendered after zoom overlay rect"
      pattern: "SVG document order determines stacking"
---

## Objective

Fix SVG element stacking order in DualTimeline.tsx so burst window rects receive pointer events and can be clicked to create slices.

**Purpose:** Close the gap identified in UAT - burst windows on the timeline cannot be clicked because the zoom/pan overlay is rendered on top, capturing all pointer events. SVG document order determines stacking order; the fix is to render burst windows after the zoom overlay so they appear on top.

**Output:** Timeline burst windows are clickable and trigger slice creation as intended.

## Execution Context

@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md

## Context

@.planning/phases/29-remake-burstlist-as-first-class-slices/29-03-SUMMARY.md
@src/components/timeline/DualTimeline.tsx

### Gap Context (from UAT.md)
- **Truth:** "Clicking a burst window in the burst list or on the timeline creates a new time slice with matching range"
- **Status:** Failed
- **Root Cause:** SVG element stacking order - zoom/pan overlay rendered AFTER burst windows, blocking all click events
- **Problem File:** src/components/timeline/DualTimeline.tsx
- **Issue:** Burst window rects rendered at lines 676-695, zoom overlay at lines 715-725. SVG document order puts zoom rect on top, capturing all pointer events.
- **Fix:** Reorder rendering so burst rects appear after zoom overlay (on top) to receive clicks

### Technical Details
- **Lines 676-695:** Burst window rects rendered (inside `<g className="burst-windows">`)
- **Lines 715-725:** Zoom/pan overlay rect rendered (for brush behavior)
- **SVG Stacking:** Elements rendered later in document order appear on top
- **Current:** Zoom overlay (715-725) renders after burst windows (676-695) → blocks clicks
- **Required:** Burst windows must render after zoom overlay to be clickable

### Code Structure
The SVG content is organized in groups. The zoom overlay is likely inside a zoom/pan group, while burst windows are in their own group. The fix requires moving the burst windows group after the zoom overlay group in the render order.

## Tasks

<task type="auto">
  <name>Task 1: Reorder SVG rendering for burst windows</name>
  <files>src/components/timeline/DualTimeline.tsx</files>
  <action>
    Fix the SVG element rendering order so burst window rects appear on top of the zoom overlay and receive pointer events:
    
    1. Open src/components/timeline/DualTimeline.tsx
    
    2. Locate the SVG structure - find where the zoom overlay and burst windows are rendered:
       - Find burst windows rendering (around lines 676-695)
       - Find zoom overlay rendering (around lines 715-725)
    
    3. Analyze the current structure:
       - The zoom overlay rect captures pointer events for zoom/pan behavior
       - Burst window rects need to be clickable for slice creation
       - SVG uses document order for z-index (later elements on top)
    
    4. Move burst window rendering AFTER zoom overlay:
       - Locate the `<g className="burst-windows">` or similar container
       - Locate the zoom overlay `<rect>` element
       - Move the entire burst windows group to render AFTER the zoom overlay in the SVG
       - This may mean moving the JSX element block to a later position in the component
    
    5. Alternative approach (if moving group is complex):
       - Keep burst windows group at current location
       - Add `pointer-events="none"` to zoom overlay rect
       - Add `pointer-events="all"` to burst window rects
       - This allows clicks to pass through zoom overlay to burst windows
       - Note: Must ensure zoom overlay still works for zoom/pan (may need restructuring)
    
    6. Preferred fix (reordering):
       - Find the zoom overlay rect (likely in a zoom/brush group)
       - Move burst windows group to render after it
       - Ensure burst windows still have onClick handlers properly bound
    
    7. Verify the structure:
       - Zoom overlay renders first (lower in stack)
       - Burst windows render second (higher in stack, receives clicks)
       - Both elements still visible and functional
    
    8. Check pointer-events:
       - Burst window rects should have pointer-events that allow clicking
       - If zoom overlay blocks, consider using CSS pointer-events: none on it
       - Or use the SVG pointer-events attribute
    
    9. Test-compile to ensure no JSX structure errors from reordering
  </action>
  <verify>
    1. Build passes: `npm run build 2>&1 | head -30`
    2. No TypeScript errors in DualTimeline.tsx
    3. Open browser dev tools on timeline-test page:
       - Inspect burst window rect element
       - Verify it appears AFTER zoom overlay in DOM/SVG tree (higher in document order)
       - Verify burst window has click handler attached
  </verify>
  <done>
    - Burst window rects render after zoom overlay in SVG document order
    - Burst windows receive pointer events and can be clicked
    - Zoom/pan overlay still functions for its intended behavior
    - Build passes with no errors
  </done>
</task>

<task type="auto">
  <name>Task 2: End-to-end burst click verification</name>
  <files>src/components/timeline/DualTimeline.tsx</files>
  <action>
    Verify the burst click functionality works end-to-end after the SVG reorder:
    
    1. Run the dev server: `npm run dev` (or ensure it's already running)
    
    2. Navigate to the timeline-test page
    
    3. Ensure there are bursts visible on the timeline:
       - If no bursts, check mock data or create test scenario
       - Burst windows should appear as colored rects on the timeline
    
    4. Test burst window click:
       - Click on a burst window rect on the timeline
       - Verify a new time slice is created with the burst's time range
       - Verify the slice appears in the unified slice list
       - Verify the "Burst" chip appears on the slice
    
    5. Test burst window reuse:
       - Click the same burst window again
       - Verify it selects the existing slice (does not create duplicate)
       - Verify the slice becomes active/selected
    
    6. Test zoom overlay still works:
       - Try zooming by dragging on the timeline (not on a burst window)
       - Verify zoom behavior still functions
       - Try panning (if supported)
       - Verify pan behavior still functions
    
    7. Test other timeline interactions:
       - Create a manual slice via click/drag
       - Adjust slice boundaries
       - Verify all existing functionality intact
    
    8. Check for console errors:
       - Open browser dev console
       - Verify no errors during burst click or other interactions
  </action>
  <verify>
    1. Manual test: Click burst window → slice created with correct range
    2. Manual test: Click same burst again → existing slice selected (no duplicate)
    3. Manual test: Zoom by dragging on timeline background → zoom works
    4. Console check: No errors during interactions
  </verify>
  <done>
    - Burst window click creates time slice with matching range
    - Duplicate clicks reuse existing slice
    - Zoom/pan overlay continues to function
    - All timeline interactions work correctly
    - No console errors
  </done>
</task>

## Verification

After completing both tasks, verify the gap is closed:

1. **Truth check:** "Clicking a burst window in the burst list or on the timeline creates a new time slice with matching range"
   - Load timeline-test page with burst windows visible
   - Click a burst window on the timeline
   - Verify a new slice is created with the burst's time range
   - Verify the slice appears in the slice list with "Burst" chip

2. **Duplicate prevention:**
   - Click the same burst window again
   - Verify no duplicate slice created
   - Verify existing slice becomes selected/active

3. **Zoom overlay functionality:**
   - Test zoom by dragging on timeline background
   - Verify zoom still works correctly
   - Test that burst windows don't interfere with zoom when not clicked directly

4. **All tests from 29-UAT pass:**
   - Test 1: Burst Windows Create Slices on Click ✓
   - Test 2: Duplicate Burst Clicks Reuse Existing Slices ✓
   - (Other tests depend on these two)

## Success Criteria

- [ ] Burst window rects render on top of zoom overlay (SVG document order)
- [ ] Burst windows receive pointer events and are clickable
- [ ] Clicking a burst window creates a time slice with matching range
- [ ] Duplicate clicks reuse existing slices (no duplicates created)
- [ ] Zoom/pan overlay continues to function for its intended behavior
- [ ] All other timeline interactions (slice creation, boundary adjustment) still work
- [ ] No console errors or warnings
- [ ] Build passes with no TypeScript errors

## Output

After completion, create `.planning/phases/29-remake-burstlist-as-first-class-slices/29-06-SUMMARY.md` documenting:
- The SVG reordering changes made
- Any pointer-events adjustments applied
- Verification results showing burst click works end-to-end
- Confirmation that zoom overlay still functions correctly
