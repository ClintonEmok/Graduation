---
phase: 29-remake-burstlist-as-first-class-slices
plan: 05
type: execute
wave: 1
depends_on:
  - phase: 29-02
    reason: Unified slice list with burst chip must exist to add rename
  - phase: 29-04
    reason: Full lifecycle parity ensures rename works with boundary editing
files_modified:
  - src/app/timeline-test/components/SliceList.tsx
  - src/components/viz/SliceManagerUI.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can rename any slice in the timeline-test SliceList via inline edit"
    - "User can rename any slice in the SliceManagerUI via inline edit"
    - "Renamed slices persist and show the new name in all UI locations"
    - "Burst chip behavior persists: renamed burst slices (no longer starting with 'Burst') hide the chip"
    - "Rename follows accessibility patterns (keyboard nav, focus management)"
  artifacts:
    - path: "src/app/timeline-test/components/SliceList.tsx"
      provides: "Slice list with inline rename affordance"
      changes:
        - "Add editable name field with click-to-edit behavior"
        - "Wire rename to useSliceStore.updateSlice(id, { name })"
        - "Add keyboard shortcuts (Enter to save, Escape to cancel)"
        - "Handle empty name (fallback to display name generation)"
    - path: "src/components/viz/SliceManagerUI.tsx"
      provides: "Slice manager with rename input"
      changes:
        - "Add name input field above time/range controls"
        - "Wire input change to useSliceStore.updateSlice(id, { name })"
  key_links:
    - from: "SliceList.tsx inline edit"
      to: "useSliceStore.updateSlice"
      via: "onChange/onBlur/onKeyDown handlers"
      pattern: "updateSlice.*name"
    - from: "SliceManagerUI.tsx name input"
      to: "useSliceStore.updateSlice"
      via: "onChange handler on input"
      pattern: "updateSlice.*name"
---

## Objective

Add inline slice rename affordance to SliceList and SliceManagerUI to complete "fully editable" parity for burst-derived and manual slices.

**Purpose:** Close the gap identified in verification - slices had boundaries, lock/visibility, but no rename UI. The store supports `updateSlice(id, { name })`; this plan adds the UI wiring.

**Output:** Both slice list interfaces support inline rename with keyboard navigation and proper focus management.

## Execution Context

@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md

## Context

@.planning/phases/29-remake-burstlist-as-first-class-slices/29-02-SUMMARY.md
@.planning/phases/29-remake-burstlist-as-first-class-slices/29-04-SUMMARY.md
@src/app/timeline-test/components/SliceList.tsx
@src/components/viz/SliceManagerUI.tsx

### Gap Context (from VERIFICATION.md)
- **Gap:** "Burst-derived slices are fully editable (boundaries, rename, lock/visibility)" failed
- **Reason:** No rename UI found in SliceList or SliceManagerUI
- **Store API:** `useSliceStore.updateSlice(id, { name })` exists and works
- **Missing:** UI affordance and wiring for renaming

### Implementation Notes
- SliceList currently displays `displayName` as static text (line 125)
- SliceManagerUI shows slice type chip but no name field
- Burst chip logic checks if displayName starts with "Burst" (SliceList line 91)
- Empty/falsy names should fall back to the existing `getSliceDisplayName` logic
- Follow existing accessibility patterns (role, aria-label, keyboard handlers)

## Tasks

<task type="auto">
  <name>Task 1: Add inline rename to SliceList</name>
  <files>src/app/timeline-test/components/SliceList.tsx</files>
  <action>
    Add inline rename capability to the slice list items:
    
    1. Import `useState` from React and add `updateSlice` from useSliceStore destructuring
    
    2. Create a local component `SliceNameEditor` or inline edit state per slice:
       - Add `editingSliceId` state to track which slice is being edited
       - Add `editingName` state for the current input value
    
    3. Replace the static display name span (line 125) with:
       - If editing: an input field with the current name value
       - If not editing: the existing span with click-to-edit behavior
    
    4. Click-to-edit behavior:
       - Double-click on name enters edit mode
       - Or add a small edit icon button next to the name
    
    5. Edit mode behavior:
       - Input auto-focused on mount
       - Enter key saves the name (calls updateSlice with trimmed value, or deletes name if empty)
       - Escape key cancels edit (reverts to original)
       - Blur saves the name
    
    6. Handle edge cases:
       - Empty name after trim → update with undefined/null to trigger fallback
       - Prevent activating slice when clicking edit controls (stopPropagation)
    
    7. Update accessibility:
       - Add aria-label for the edit button (if using button pattern)
       - Ensure input has proper aria-label
    
    Pattern to follow: Keep it simple like standard inline edit - click name to edit, blur/Enter to save, Escape to cancel.
  </action>
  <verify>
    1. Build passes: `npm run build 2>&1 | head -30`
    2. No TypeScript errors in modified file
    3. Manual test: Load timeline-test page, create a slice, click name to edit, type new name, press Enter
  </verify>
  <done>
    - SliceList items have inline rename affordance
    - Renaming a slice updates the store via updateSlice
    - Renamed burst slices hide the burst chip (if name no longer starts with "Burst")
    - Keyboard navigation works (Enter saves, Escape cancels)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add rename input to SliceManagerUI</name>
  <files>src/components/viz/SliceManagerUI.tsx</files>
  <action>
    Add a name input field to each slice item in SliceManagerUI:
    
    1. Locate the slice item rendering section (around line 226, inside slices.map)
    
    2. Add a name input field as the first element in the slice card:
       - Place above the type chip and time/range controls
       - Use a compact input style (h-8, text-sm)
       - Show current slice.name or empty if using fallback
       - Placeholder: "Slice name" or the fallback display name
    
    3. Wire the input:
       - value={slice.name || ''}
       - onChange={(e) => updateSlice(slice.id, { name: e.target.value.trim() || undefined })}
       - Clear name entirely if user deletes all text (set to undefined to trigger fallback)
    
    4. Style considerations:
       - Match existing input patterns in the file
       - Keep compact to not add too much vertical space
       - Consider using the same styling as the time/range buttons for consistency
    
    5. Optional enhancements (if time permits):
       - Add a small label above: "Name" 
       - Or use placeholder text showing the fallback name
    
    6. Ensure the input doesn't interfere with other controls
  </action>
  <verify>
    1. Build passes: `npm run build 2>&1 | head -30`
    2. Open SliceManagerUI (via sheet trigger), verify name inputs appear for each slice
    3. Type a new name, verify it updates in real-time
    4. Clear the name, verify fallback naming resumes
  </verify>
  <done>
    - SliceManagerUI shows name input for each slice
    - Input updates slice name via updateSlice
    - Clearing input restores fallback naming
    - Visual styling consistent with existing controls
  </done>
</task>

## Verification

After completing both tasks, verify the gap is closed:

1. **Truth check:** "Burst-derived slices are fully editable (boundaries, rename, lock/visibility)"
   - Create a burst slice
   - Verify rename works in both SliceList and SliceManagerUI
   - Verify lock/visibility still work
   - Verify boundary adjustment still works

2. **Cross-location consistency:**
   - Rename in SliceList → name updates in SliceManagerUI
   - Rename in SliceManagerUI → name updates in SliceList

3. **Burst chip behavior:**
   - Burst slice named "Burst 1" shows chip
   - Rename to "My Event" → chip disappears
   - Rename back to "Burst 1" → chip reappears

4. **Edge cases:**
   - Empty name → falls back to "Slice N" or "Burst N"
   - Whitespace-only name → treated as empty
   - Very long names → truncate with ellipsis

## Success Criteria

- [ ] SliceList supports inline rename with keyboard shortcuts
- [ ] SliceManagerUI supports rename via input field
- [ ] Renaming works for both manual and burst-derived slices
- [ ] Burst chip visibility correctly responds to rename
- [ ] Fallback naming works when name is cleared
- [ ] Build passes with no new TypeScript errors
- [ ] Accessibility maintained (keyboard nav, focus management, labels)

## Output

After completion, create `.planning/phases/29-remake-burstlist-as-first-class-slices/29-05-SUMMARY.md` documenting:
- Implementation details for both rename affordances
- Any deviations from planned approach
- Verification that the gap is closed
