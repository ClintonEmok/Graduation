---
phase: 05-adaptive-visualization-aids
plan: 03
type: execute
wave: 3
depends_on: [05-02]
files_modified:
  - src/components/timeline/TimelinePanel.tsx
autonomous: true
must_haves:
  truths:
    - "TimelinePanel displays the Histogram and Axis"
    - "Aids are positioned correctly relative to the slider"
    - "Aids respond to Linear/Adaptive toggle"
  artifacts:
    - path: "src/components/timeline/TimelinePanel.tsx"
      contains: "DensityHistogram"
  key_links:
    - from: "src/components/timeline/TimelinePanel.tsx"
      to: "src/components/timeline/DensityHistogram.tsx"
      via: "JSX render"
---

<objective>
Integrate the visualization aids into the main Timeline Panel.

Purpose: To expose the adaptive visualization tools to the user.
Output: An updated TimelinePanel containing the Histogram and Axis.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/components/timeline/TimelinePanel.tsx
@src/components/timeline/DensityHistogram.tsx
@src/components/timeline/AdaptiveAxis.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Components into TimelinePanel</name>
  <files>src/components/timeline/TimelinePanel.tsx</files>
  <action>
    Modify `TimelinePanel.tsx`:
    1. Import `DensityHistogram` and `AdaptiveAxis`.
    2. Add a wrapper container (e.g., using `visx/responsive`'s `ParentSize` or just a fixed height div) above the `Slider`.
    3. Pass the container's width to the components (if using ParentSize) or use a fixed/responsive approach.
    4. Arrange them: Histogram on top, Axis below it (or aligned with Slider).
    5. Ensure the visual timeline aligns with the interactive Slider (which is 0-100 range).
       - Note: The Slider is linear (0-100). The Axis/Histogram might be Adaptive.
       - *Challenge:* If the slider remains linear 0-100, but the view is adaptive, the slider handle position (e.g. at 50) might not match the visual "middle" of the adaptive axis.
       - *Resolution:* For Phase 5, just place them. Phase 8 (Coordinated Views) handles complex sync.
       - However, the `Slider` controls `currentTime` (0..100). The Adaptive Scale maps `0..100` -> `pixels`. So if we draw a "current time" line on the histogram using the adaptive scale, it will match the 3D view.
       - Add a "Current Time Indicator" (vertical line) to the Histogram that uses the same scale, so the user sees where `currentTime` falls on the adaptive map.
  </action>
  <verify>Check JSX structure for Histogram/Axis</verify>
  <done>Components integrated and aligned</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Adaptive Visualization Aids (Histogram + Axis)</what-built>
  <how-to-verify>
    1. Run the app (`npm run dev`).
    2. Toggle "Time Scale: Adaptive".
    3. Observe the Axis ticks: do they bunch up/spread out?
    4. Observe the Histogram: do the bars change width?
    5. Check if the "Current Time" matches the visualization.
  </how-to-verify>
  <resume-signal>Visuals confirmed or issues noted</resume-signal>
</task>

</tasks>

<verification>
- TimelinePanel renders without errors.
- Visual check passes.
</verification>

<success_criteria>
- User sees the histogram and axis.
- Toggling modes updates the visualization.
</success_criteria>

<output>
After completion, create `.planning/phases/05-adaptive-visualization-aids/05-03-SUMMARY.md`
</output>
