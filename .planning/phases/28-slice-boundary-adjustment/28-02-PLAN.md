---
phase: 28-slice-boundary-adjustment
plan: 02
type: execute
wave: 2
depends_on: [28-01]
files_modified:
  - src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
  - src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
  - src/app/timeline-test/components/CommittedSliceLayer.tsx
  - src/app/timeline-test/page.tsx
autonomous: true
must_haves:
  truths:
    - Selected or hovered range slices expose distinct start and end drag handles.
    - Dragging either handle updates boundary geometry and duration feedback in real time.
    - Non-active slices dim during active boundary drag without blocking interaction flow.
  artifacts:
    - path: src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
      provides: Pointer-capture drag lifecycle and live writes to `useSliceStore.updateSlice`.
    - path: src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
      provides: Handle hit targets (8px visual / 12px effective), hover states, tooltip, and drag event wiring.
    - path: src/app/timeline-test/page.tsx
      provides: Overlay stack mount for boundary handles above committed fill layer.
    - path: src/app/timeline-test/components/CommittedSliceLayer.tsx
      provides: Dimming support for non-active slices while adjustment drag is active.
  key_links:
    - from: src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
      to: src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
      via: Handle pointerdown/move/up handlers
      pattern: onPointerDown|onPointerMove|onPointerUp
    - from: src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
      to: src/store/useSliceStore.ts
      via: Real-time boundary updates
      pattern: updateSlice\(
    - from: src/app/timeline-test/page.tsx
      to: src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
      via: Overlay composition order
      pattern: SliceBoundaryHandlesLayer
---

<objective>
Ship the interactive boundary-handle layer and real-time drag wiring on top of committed slice overlays.

Purpose: Deliver ADJUST-01 through ADJUST-04 behavior with precise targeting and immediate visual feedback.
Output: Mounted handle layer, pointer-capture adjustment hook, and drag-aware committed overlay dimming.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/28-slice-boundary-adjustment/28-CONTEXT.md
@.planning/phases/28-slice-boundary-adjustment/28-RESEARCH.md
@.planning/phases/28-slice-boundary-adjustment/28-01-SUMMARY.md
@src/app/timeline-test/components/CommittedSliceLayer.tsx
@src/app/timeline-test/page.tsx
@src/store/useSliceStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement pointer-capture boundary adjustment hook</name>
  <files>src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts</files>
  <action>Create a dedicated hook that manages handle drag lifecycle using pointer capture: initialize drag context from selected range slice, track active handle (`start|end`), map x-position to UTC seconds through timeline scale inversion, call `slice-adjustment` math helpers, and apply real-time updates through `useSliceStore.updateSlice`. Ensure hard-stop behavior at min duration/domain limits and clear lifecycle state on pointerup/pointercancel. Keep opposite boundary fixed during constraints and avoid whole-slice movement.</action>
  <verify>npm run lint -- src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts</verify>
  <done>Dragging start/end handle updates only that boundary in real time and never violates domain/min-duration constraints.</done>
</task>

<task type="auto">
  <name>Task 2: Build dedicated boundary handles layer with tooltip feedback</name>
  <files>src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx</files>
  <action>Create a separate interactive SVG layer for range slices only, rendering start/end handles when slice is selected or hovered. Use approximately 8px visible handle width with approximately 12px effective hit area; style idle/hover/active states with low-noise but clear contrast. Wire events to `useSliceBoundaryAdjustment` and render live floating tooltip near active handle showing boundary time and current duration while dragging.</action>
  <verify>npm run lint -- src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx</verify>
  <done>Handles are easy to target at multiple zoom levels and tooltip updates continuously during drag interactions.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate handles layer into timeline stack and dim inactive slices</name>
  <files>src/app/timeline-test/page.tsx, src/app/timeline-test/components/CommittedSliceLayer.tsx</files>
  <action>Mount `SliceBoundaryHandlesLayer` above committed overlays in `/timeline-test` detail track and pass required scale/domain/slice state props. Update committed slice layer styling to dim non-active slices only while an adjustment drag is active, without changing persisted slice data. Preserve existing creation overlay order and ensure handle interactions do not leak to underlying timeline scrub/zoom handlers.</action>
  <verify>npm run lint -- src/app/timeline-test/page.tsx src/app/timeline-test/components/CommittedSliceLayer.tsx</verify>
  <done>Boundary handles are visible and interactive in the proper z-order; active drag focus is clear while non-active slices remain contextually visible.</done>
</task>

</tasks>

<verification>
Run: `npm run lint -- src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx src/app/timeline-test/components/CommittedSliceLayer.tsx src/app/timeline-test/page.tsx`
Run: `npm run test -- src/store/useSliceStore.test.ts`
Manual check in `/timeline-test`: drag start and end handles on selected slices and confirm real-time geometry + duration feedback.
</verification>

<success_criteria>
Users can reliably grab start/end handles and see live boundary updates with focused drag feedback, satisfying ADJUST-01 through ADJUST-04.
</success_criteria>

<output>
After completion, create `.planning/phases/28-slice-boundary-adjustment/28-02-SUMMARY.md`
</output>
