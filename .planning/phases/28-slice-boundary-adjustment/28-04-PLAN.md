---
phase: 28-slice-boundary-adjustment
plan: 04
type: execute
wave: 4
depends_on: [28-03]
files_modified:
  - src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
  - src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
  - src/store/useSliceAdjustmentStore.ts
  - src/store/useSliceAdjustmentStore.test.ts
autonomous: false
gap_closure: true
must_haves:
  truths:
    - During fast boundary drags, the active start/end handle remains visually aligned with the slice boundary (no visible trailing).
    - Dragging at high pointer speed still updates boundary geometry and tooltip continuously in the same interaction frame.
    - Constraint and snap behavior remain intact while improving real-time precision.
  artifacts:
    - path: src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
      provides: Non-lagging handle rendering path for active drag state.
    - path: src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
      provides: Per-move live boundary payload for render synchronization.
    - path: src/store/useSliceAdjustmentStore.ts
      provides: Transient live-drag position fields used only during active drag.
    - path: src/store/useSliceAdjustmentStore.test.ts
      provides: Regression coverage for live-drag store lifecycle reset/update behavior.
  key_links:
    - from: src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
      to: src/store/useSliceAdjustmentStore.ts
      via: updateDrag payload includes live boundary position for active handle
      pattern: updateDrag\(\{.*live
    - from: src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
      to: src/store/useSliceAdjustmentStore.ts
      via: Active handle X derives from live drag payload instead of delayed visual interpolation
      pattern: live.*boundary|dragging.*handle
    - from: src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
      to: src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
      via: Pointer-move result drives immediate handle/tooltip sync
      pattern: tooltip|boundarySec
---

<objective>
Close the diagnosed ADJUST-04 runtime precision gap where handle bars visually lag behind slice bounds during fast drags.

Purpose: Restore high-confidence real-time interaction quality so fast pointer movement still feels precise and direct.
Output: Drag-synced handle rendering update, transient live-drag state wiring, and regression checks plus human UX validation.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/28-slice-boundary-adjustment/28-CONTEXT.md
@.planning/phases/28-slice-boundary-adjustment/28-RESEARCH.md
@.planning/phases/28-slice-boundary-adjustment/28-slice-boundary-adjustment-VERIFICATION.md
@.planning/phases/28-slice-boundary-adjustment/28-03-SUMMARY.md
@src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx
@src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts
@src/store/useSliceAdjustmentStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove visual trailing and wire immediate active-handle position updates</name>
  <files>src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx, src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts</files>
  <action>Update boundary-handle rendering so active drag position is driven directly by live pointer-adjusted boundary data, not by delayed visual interpolation. Specifically remove/avoid position-transition styling that causes trailing during drag (for example broad `transition-all` on moving handle geometry), keep color-state transitions if desired, and ensure active handle x-position uses the current drag result on every pointer move. Do not add throttling/debouncing to drag updates; this gap is about fast-drag fidelity.</action>
  <verify>npm run lint -- src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts</verify>
  <done>When dragging quickly, the active handle visually tracks the adjusted boundary without the observed lag-behind effect.</done>
</task>

<task type="auto">
  <name>Task 2: Add transient live-drag state regression coverage</name>
  <files>src/store/useSliceAdjustmentStore.ts, src/store/useSliceAdjustmentStore.test.ts, src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts</files>
  <action>Extend `useSliceAdjustmentStore` with explicit transient live-drag fields needed for active-handle sync (for example live boundary seconds/position keyed to dragging handle), update `updateDrag` lifecycle wiring from the boundary-adjustment hook, and add focused store tests proving the live fields update per drag event and always reset on `endDrag`. Keep persisted slice data flow unchanged (`useSliceStore.updateSlice` remains source of committed geometry).</action>
  <verify>npm run test -- src/store/useSliceAdjustmentStore.test.ts</verify>
  <done>Automated tests cover live-drag state updates and cleanup, preventing regressions where handle visuals drift from active drag state.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fast-drag precision fix for boundary handles with live active-handle sync.</what-built>
  <how-to-verify>
    1) Run `npm run dev` and open `/timeline-test`.
    2) Select a range slice, then rapidly drag both start and end handles across long distances.
    3) Repeat in dense regions with snap on and with Alt/Option held (snap bypass).
    4) Confirm the handle bars stay aligned with slice boundaries during movement (no trailing), tooltip stays continuous, and min-duration/domain constraints still behave correctly.
  </how-to-verify>
  <resume-signal>Type "approved" if lag is resolved, or describe remaining lag behavior with a short repro note.</resume-signal>
</task>

</tasks>

<verification>
Run: `npm run test -- src/store/useSliceAdjustmentStore.test.ts`
Run: `npm run lint -- src/app/timeline-test/components/SliceBoundaryHandlesLayer.tsx src/app/timeline-test/hooks/useSliceBoundaryAdjustment.ts src/store/useSliceAdjustmentStore.ts src/store/useSliceAdjustmentStore.test.ts`
Manual check in `/timeline-test`: perform high-speed handle drags and confirm no visible handle trailing relative to live slice bounds.
</verification>

<success_criteria>
The ADJUST-04 real-time precision gap is closed: high-speed boundary dragging keeps active handles visually locked to slice bounds while preserving existing constraints and snap behaviors.
</success_criteria>

<output>
After completion, create `.planning/phases/28-slice-boundary-adjustment/28-04-SUMMARY.md`
</output>
