---
phase: 25-adaptive-intervals
plan: 02
type: execute
wave: 2
depends_on: [25-01]
files_modified:
  - src/components/viz/SpaceTimeCube.tsx
  - src/components/timeline/DualTimeline.tsx
  - src/components/viz/GridLines.tsx
  - src/components/ui/Controls.tsx
autonomous: true
must_haves:
  truths:
    - "Timeline histogram bins adjust to screen pixel density"
    - "3D points expand/contract smoothly as warp factor changes"
    - "Timeline X-axis matches 3D Z-axis perfectly during blend"
  artifacts:
    - path: src/components/timeline/DualTimeline.tsx
      contains: "thresholds(width"
    - path: src/components/ui/Controls.tsx
      contains: "setWarpFactor"
  key_links:
    - from: src/hooks/useTimeWarp.ts
      to: src/components/timeline/DualTimeline.tsx
      via: "toAdaptive projection"
---

<objective>
Wire the adaptive blending logic into the visualization components.
Purpose: Allow users to interactively blend between Uniform (Linear) and Adaptive (CDF) time to "feel" the data density.
Output: Integrated adaptive view with slider control.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/25-adaptive-intervals/25-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Warp Slider</name>
  <files>src/components/ui/Controls.tsx</files>
  <action>
    Add a Slider component to `Controls.tsx`.
    - Label: "Adaptive Warp" (0% to 100%).
    - Connect to `useCoordinationStore`'s `warpFactor`.
    - Range: 0.0 to 1.0.
    - Step: 0.01 (smooth sliding).
    
    This replaces the binary toggle idea with the "Linear Blend" strategy (Option C).
  </action>
  <verify>
    Sliding updates store state smoothly.
  </verify>
  <done>
    User can blend between linear and adaptive time.
  </done>
</task>

<task type="auto">
  <name>Task 2: Warp the Space-Time Cube</name>
  <files>src/components/viz/SpaceTimeCube.tsx, src/components/viz/GridLines.tsx</files>
  <action>
    1. In `SpaceTimeCube.tsx`, use `useTimeWarp`.
    2. Update point positions: `z = toAdaptive(point.timestamp)`.
       - Because `toAdaptive` now respects `warpFactor`, this will animate vertex positions if the component re-renders.
    3. Update `GridLines.tsx` (Z-axis):
       - Position ticks at visual intervals (0, 10, 20... 100).
       - Label ticks using `toLinear(z)` formatted as time.
       - As user slides the slider, the grid lines should stay fixed (visually), but their time labels should shift to reflect the changing scale.
  </action>
  <verify>
    Drag the slider:
    - Cube geometry should smoothly stretch/compress.
    - Grid labels should update in real-time.
  </verify>
  <done>
    3D visualization supports smooth adaptive warping.
  </done>
</task>

<task type="auto">
  <name>Task 3: Upgrade Timeline to Adaptive Density</name>
  <files>src/components/timeline/DualTimeline.tsx</files>
  <action>
    1. Integrate `useTimeWarp` into `DualTimeline.tsx`.
    2. **Binning Logic:**
       - Use "Screen Pixel Density" logic: `binCount = Math.floor(width / 4)`.
    3. **Coordinate System:**
       - Use `toAdaptive(timestamp)` to map events to the X-axis.
       - The X-axis must match the Cube's Z-axis (0-100 normalized adaptive time).
    4. **Axis Labels:**
       - Draw ticks at visual intervals.
       - Label using `toLinear(x)` to show real time.
    5. **Responsiveness:**
       - Ensure the timeline redraws efficiently during slider drag.
  </action>
  <verify>
    - Timeline bars shift and resize smoothly when slider is dragged.
    - Alignment with 3D view is maintained at all blend factors (0, 0.5, 1).
  </verify>
  <done>
    Timeline fully supports linear blending strategy.
  </done>
</task>

</tasks>

<verification>
Ensure visual alignment between Timeline X-axis and Cube Z-axis. A selected range on the timeline should correspond exactly to the vertical slice in the cube, regardless of warp factor.
</verification>

<success_criteria>
- [ ] Timeline uses dynamic bin count.
- [ ] Slider smoothly interpolates between Linear (0) and Adaptive (1).
- [ ] 3D and 2D views stay synchronized during transition.
</success_criteria>

<output>
After completion, create `.planning/phases/25-adaptive-intervals/25-02-SUMMARY.md`
</output>
