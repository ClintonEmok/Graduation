---
phase: 25-adaptive-intervals-burstiness
plan: 03
type: execute
wave: 2
depends_on: [01]
files_modified:
  - src/components/timeline/DensityTrack.tsx
  - src/components/timeline/TimelineLayout.tsx
  - src/components/timeline/AdaptiveControls.tsx
autonomous: true
must_haves:
  truths:
    - "Timeline displays a density heatmap/bar above the main track"
    - "Red/Blue shift coloring indicates expansion vs compression"
    - "Slider in header controls the 3D warp"
  artifacts:
    - path: "src/components/timeline/DensityTrack.tsx"
      provides: "Visual density indicator"
    - path: "src/components/timeline/AdaptiveControls.tsx"
      provides: "Slider UI"
  key_links:
    - from: "src/store/useAdaptiveStore.ts"
      to: "src/components/timeline/DensityTrack.tsx"
      via: "densityMap subscription"
---

<objective>
Integrate the adaptive time controls and density visualization into the Timeline UI.

Purpose: Provide users with control over the warp factor and visual feedback on how time is being distorted (density).
Output: A new Density Track in the timeline and a Warp Slider in the header.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/components/timeline/TimelineContainer.tsx
@src/store/useAdaptiveStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Adaptive Controls UI</name>
  <files>src/components/timeline/AdaptiveControls.tsx</files>
  <action>
    Create a polished `AdaptiveControls` component.
    Elements:
    - Slider (Range 0-100 or 0-1).
    - Label "Adaptive Warp".
    - Connect to `useAdaptiveStore` (setWarpFactor).
    - Style to match the application theme (Tailwind).
  </action>
  <verify>
    Render component. Check sliding updates store.
  </verify>
  <done>Controls component ready.</done>
</task>

<task type="auto">
  <name>Task 2: Create Density Track</name>
  <files>src/components/timeline/DensityTrack.tsx</files>
  <action>
    Create `DensityTrack` component.
    Props: `width`, `height`.
    Data: `useAdaptiveStore.densityMap`.
    Logic:
    - Render a Canvas or SVG heatmap strip.
    - Map density values to color:
      - Low density = Blue (Expanded time).
      - High density = Red (Compressed time).
    - Or as requested: "Red/Blue shift like physics".
      - Moving towards (dense) = Blue? Moving away (sparse) = Red?
      - Let's stick to standard heatmap: High Density (Events packed) = Hot/Red. Low Density (Empty) = Cold/Blue.
      - Wait, "Red/Blue shift" usually means Doppler.
      - If time is *expanded* (slowed down), it's "stretched" (Red shift?).
      - If time is *compressed* (sped up), it's "squeezed" (Blue shift?).
      - Let's implement High Density = Blue (Compressed), Low Density = Red (Expanded).
      - Add a legend or tooltip if needed.
  </action>
  <verify>
    Verify track renders colors corresponding to known data peaks.
  </verify>
  <done>Density track visualizes the warp field.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into Timeline Layout</name>
  <files>src/components/timeline/TimelineLayout.tsx, src/components/timeline/TimelineContainer.tsx</files>
  <action>
    1. Add `DensityTrack` to the Timeline stack (above the brush or main axis).
    2. Add `AdaptiveControls` to the Timeline Header or Sidebar.
    3. Ensure layout handles the extra height/width.
  </action>
  <verify>
    Visual check.
  </verify>
  <done>UI components are integrated and visible.</done>
</task>

</tasks>

<verification>
- [ ] Slider is accessible and working.
- [ ] Density track aligns with the time axis.
- [ ] Colors make sense relative to data distribution.
</verification>

<success_criteria>
- User interface allows control and understanding of the adaptive time feature.
</success_criteria>

<output>
After completion, create `.planning/phases/25-adaptive-intervals-burstiness/25-03-SUMMARY.md`
</output>
