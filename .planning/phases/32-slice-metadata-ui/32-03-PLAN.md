---
phase: 32-slice-metadata-ui
plan: 03
type: execute
wave: 2
depends_on:
  - 32-01
files_modified:
  - src/app/timeline-test/components/SliceList.tsx
autonomous: true

must_haves:
  truths:
    - "User can add/edit notes for each slice"
    - "Notes preview visible in slice list (truncated)"
    - "Full notes visible on hover as tooltip"
    - "Notes can be expanded to inline text area"
    - "Notes persist across sessions"
  artifacts:
    - path: "src/app/timeline-test/components/SliceList.tsx"
      provides: "Notes UI with truncated preview, tooltip, and inline expansion"
      contains: "notes.*tooltip|notes.*textarea|notes.*expand"
  key_links:
    - from: "SliceList.tsx"
      to: "useSliceStore"
      via: "updateSlice with notes field"
      pattern: "updateSlice.*notes"
---

<objective>
Add notes/annotation UI to slice list with tooltip, truncated preview, and inline expansion.

Purpose: Allow users to add textual annotations to slices that are visible on hover and can be expanded for editing.

Output: Notes field in slice list with hover tooltip, preview text, and expand functionality.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
# Existing Patterns
@src/app/timeline-test/components/SliceList.tsx (lines 115-129): inline edit pattern for names
- startEditing, saveEditing, cancelEditing functions
- isEditing state for each slice
- Use this same pattern for notes expansion

# Notes UI Requirements
1. Truncated preview: Show first 30 characters with "..." if longer
2. Hover tooltip: Show full notes on mouse hover (native title or custom tooltip)
3. Expand button: Click to open inline textarea
4. Inline textarea: Full-width textarea for editing
5. Save on blur or Enter (Shift+Enter for newline)
6. Cancel with Escape

# Key Files
@src/app/timeline-test/components/SliceList.tsx
</context>

<tasks>

<task type="auto">
  <name>Add notes UI to SliceList</name>
  <files>src/app/timeline-test/components/SliceList.tsx</files>
  <action>
Add notes annotation feature to SliceList component.

1. Add state for notes editing (after line 50):
```typescript
const [editingNotesSliceId, setEditingNotesSliceId] = useState<string | null>(null);
const [editingNotes, setEditingNotes] = useState('');
```

2. Add helper functions for notes (after cancelEditing, around line 129):
```typescript
const startNotesEditing = (slice: TimeSlice) => {
  setEditingNotesSliceId(slice.id);
  setEditingNotes(slice.notes ?? '');
};

const cancelNotesEditing = () => {
  setEditingNotesSliceId(null);
  setEditingNotes('');
};

const saveNotesEditing = (slice: TimeSlice) => {
  updateSlice(slice.id, { notes: editingNotes.trim() || undefined });
  cancelNotesEditing();
};
```

3. Add notes display and editor in the slice item (around line 233, after the Selected badge):
- If slice has notes and NOT editing: show truncated preview with "..." (max 30 chars)
- Add a small "expand" button (maybe a message/comment icon) to open full notes
- On hover: show full notes in native tooltip (title attribute)
- When expanded: show textarea (height ~60px) with current notes
- On blur or Enter: save notes
- On Escape: cancel editing

Example structure:
```tsx
{slice.notes && editingNotesSliceId !== slice.id && (
  <div className="mt-1 text-[10px] text-slate-400">
    <span title={slice.notes} className="truncate block max-w-[150px]">
      {slice.notes.slice(0, 30)}{slice.notes.length > 30 ? '...' : ''}
    </span>
    <button
      type="button"
      onClick={(e) => { e.stopPropagation(); startNotesEditing(slice); }}
      className="text-slate-500 hover:text-slate-300"
    >
      <MessageSquare className="h-3 w-3" />
    </button>
  </div>
)}

{editingNotesSliceId === slice.id && (
  <textarea
    value={editingNotes}
    onChange={(e) => setEditingNotes(e.target.value)}
    onBlur={() => saveNotesEditing(slice)}
    onKeyDown={(e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        saveNotesEditing(slice);
      }
      if (e.key === 'Escape') {
        e.preventDefault();
        cancelNotesEditing();
      }
    }}
    className="mt-1 w-full rounded border border-slate-600 bg-slate-900 px-2 py-1 text-xs text-slate-200"
    rows={2}
  />
)}
```

Note: Import MessageSquare from lucide-react at the top of the file.
  </action>
  <verify>
Build succeeds. SliceList renders notes UI when slices have notes field populated.
  </verify>
  <done>SliceList has working notes UI with truncated preview, tooltip on hover, and inline expansion for editing</done>
</task>

</tasks>

<verification>
1. Slices with notes show truncated preview (30 chars + "...")
2. Hovering over notes preview shows full text in tooltip
3. Click expand button opens inline textarea
4. Saving notes updates slice.notes in store
5. Notes persist across page refreshes (Zustand persist)
6. Escape cancels notes editing without saving
</verification>

<success_criteria>
- Notes preview visible in slice list items
- Tooltip shows full notes on hover
- Inline textarea allows editing notes
- Notes save to store and persist in localStorage
</success_criteria>

<output>
After completion, create `.planning/phases/32-slice-metadata-ui/32-03-SUMMARY.md`
</output>
