---
phase: 32-slice-metadata-ui
plan: 02
type: execute
wave: 2
depends_on:
  - 32-01
files_modified:
  - src/app/timeline-test/components/SliceList.tsx
  - src/app/timeline-test/components/CommittedSliceLayer.tsx
autonomous: true

must_haves:
  truths:
    - "User can select a color from preset palette in slice list"
    - "Selected color displays on slice in timeline visualization"
    - "Color selection persists across sessions"
  artifacts:
    - path: "src/app/timeline-test/components/SliceList.tsx"
      provides: "Color selector UI in slice list item"
      contains: "color.*selector|ColorPicker|color.*palette"
    - path: "src/app/timeline-test/components/CommittedSliceLayer.tsx"
      provides: "Slice rendering with dynamic color from slice.color"
      contains: "slice\\.color|color.*slice"
  key_links:
    - from: "SliceList.tsx"
      to: "CommittedSliceLayer.tsx"
      via: "slice.color field in useSliceStore"
      pattern: "updateSlice.*color|slice\\.color"
---

<objective>
Add color picker UI to slice list and apply selected color to timeline visualization.

Purpose: Allow users to visually distinguish slices by assigning preset colors that appear in the timeline.

Output: Color selector dropdown in slice list; CommittedSliceLayer renders slices with their assigned color.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
# Color Palette (8 colors)
Preset colors: amber, blue, green, red, purple, cyan, pink, gray

Each color maps to Tailwind classes for rendering:
- amber: bg-amber-400/50, border-amber-300
- blue: bg-blue-400/50, border-blue-300
- green: bg-green-400/50, border-green-300
- red: bg-red-400/50, border-red-300
- purple: bg-purple-400/50, border-purple-300
- cyan: bg-cyan-400/50, border-cyan-300
- pink: bg-pink-400/50, border-pink-300
- gray: bg-slate-400/50, border-slate-300

# Existing Patterns
@src/app/timeline-test/components/SliceList.tsx (lines 115-129): inline edit pattern
- startEditing, saveEditing, cancelEditing functions
- isEditing state for each slice

@src/app/timeline-test/components/CommittedSliceLayer.tsx (lines 148-162): slice styling
- Uses conditional classes for isActive, isSelected, isBurst states
- Hardcoded amber/orange/blue/cyan colors
- Need to add color-based styling

# Key Files
@src/app/timeline-test/components/SliceList.tsx
@src/app/timeline-test/components/CommittedSliceLayer.tsx
</context>

<tasks>

<task type="auto">
  <name>Add color selector to SliceList</name>
  <files>src/app/timeline-test/components/SliceList.tsx</files>
  <action>
Add a color selector UI next to the edit button in each slice list item.

1. Define the color palette constant at the top of the file (after imports):
```typescript
const SLICE_COLORS = [
  { name: 'amber', class: 'bg-amber-400', label: 'Amber' },
  { name: 'blue', class: 'bg-blue-400', label: 'Blue' },
  { name: 'green', class: 'bg-green-400', label: 'Green' },
  { name: 'red', class: 'bg-red-400', label: 'Red' },
  { name: 'purple', class: 'bg-purple-400', label: 'Purple' },
  { name: 'cyan', class: 'bg-cyan-400', label: 'Cyan' },
  { name: 'pink', class: 'bg-pink-400', label: 'Pink' },
  { name: 'gray', class: 'bg-slate-400', label: 'Gray' },
] as const;
```

2. Add state for color picker visibility (after line 50):
```typescript
const [colorPickerSliceId, setColorPickerSliceId] = useState<string | null>(null);
```

3. Add color selector button and dropdown in the slice item (around line 221, after the rename button):
- Show a small color circle indicator if slice has a color
- On click, show a dropdown with color options
- On select, call `updateSlice(slice.id, { color: selectedColorName })`
- Close picker on selection or click outside

The color selector should appear after the pencil (edit) button and before the burst chip.
  </action>
  <verify>
Build succeeds and SliceList renders without errors. Color selector appears in UI when slices exist.
  </verify>
  <done>SliceList has color selector UI that updates slice.color in store</done>
</task>

<task type="auto">
  <name>Apply slice color to CommittedSliceLayer rendering</name>
  <files>src/app/timeline-test/components/CommittedSliceLayer.tsx</files>
  <action>
Modify CommittedSliceLayer to apply slice color when rendering.

1. Add color to SliceGeometry interface (around line 13-22):
```typescript
interface SliceGeometry {
  id: string;
  left: number;
  width: number;
  isActive: boolean;
  isSelected: boolean;
  isBurst: boolean;
  isPoint: boolean;
  isRange: boolean;
  color?: string;  // NEW
}
```

2. Pass color through when building geometries (around lines 52-102):
- Extract slice.color when mapping slices to geometries
- Include color in the returned geometry object

3. Update the styling logic (lines 148-162) to use slice color:
- If geometry.color exists, use color-specific Tailwind classes
- Fall back to existing amber/orange/blue/cyan logic when no color set

Color mapping (add helper function):
```typescript
const getColorClasses = (color?: string): { bg: string; border: string } => {
  const colors: Record<string, { bg: string; border: string }> = {
    amber: { bg: 'bg-amber-400/50', border: 'border-amber-300' },
    blue: { bg: 'bg-blue-400/50', border: 'border-blue-300' },
    green: { bg: 'bg-green-400/50', border: 'border-green-300' },
    red: { bg: 'bg-red-400/50', border: 'border-red-300' },
    purple: { bg: 'bg-purple-400/50', border: 'border-purple-300' },
    cyan: { bg: 'bg-cyan-400/50', border: 'border-cyan-300' },
    pink: { bg: 'bg-pink-400/50', border: 'border-pink-300' },
    gray: { bg: 'bg-slate-400/50', border: 'border-slate-300' },
  };
  return colors[color || ''] || { bg: '', border: '' };
};
```

4. Apply color classes in the className string, placing color classes before the existing state-based classes (so state classes can override if needed for active/selected states).
  </action>
  <verify>
Build succeeds. Slices with assigned colors display those colors in the timeline visualization.
  </verify>
  <done>CommittedSliceLayer renders slices with their assigned color from slice.color field</done>
</task>

</tasks>

<verification>
1. Color selector appears in slice list UI
2. Clicking a color updates the slice's color field in the store
3. Colored slices display with the selected color in the timeline
4. Slices without color continue to use existing amber/orange styling
5. Color selection persists via Zustand persist (localStorage)
</verification>

<success_criteria>
- SliceList has working color selector with 8 preset colors
- CommittedSliceLayer renders slices with assigned colors
- Default uncolored slices retain existing visual behavior
- Color metadata persists across page refreshes
</success_criteria>

<output>
After completion, create `.planning/phases/32-slice-metadata-ui/32-02-SUMMARY.md`
</output>
