---
phase: 37-algorithm-integration
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/useSuggestionStore.ts
  - src/store/useWarpSliceStore.ts
  - src/app/timeslicing/components/SuggestionPanel.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Only one warp profile active at a time"
    - "Visual indicator shows which warp is currently active"
    - "Accepting new warp replaces previous warp"
    - "Active warp badge shows on suggestion card"
  artifacts:
    - path: "src/store/useWarpSliceStore.ts"
      provides: "Active warp tracking"
---

<objective>
Ensure only one warp profile can be active at a time, with clear visual feedback.

Purpose: Prevent confusion by making the single-warp constraint explicit in the UI.
</objective>

<context>
Important constraint: Only 1 warp can be active at a time.
- Accepting a new warp should replace the current one
- UI should clearly show which warp is active
- Users should understand their action will replace the current warp
</context>

<tasks>

<task type="auto">
  <name>Track active warp and replace on accept</name>
  <files>src/store/useWarpSliceStore.ts, src/app/timeslicing/page.tsx</files>
  <action>
    Implement single-warp constraint:
    1. Add activeWarpId to useWarpSliceStore to track currently active warp
    2. When accepting a warp profile suggestion:
       - First clear/remove any existing warp slices (or deactivate them)
       - Then create the new warp slices
       - Set the new warp as active
    3. Add helper: setActiveWarp(id), clearActiveWarp(), getActiveWarp()
    4. When user hovers existing warp, show "Will replace current warp" warning
  </action>
  <verify>Accepting new warp replaces the previous one</verify>
  <done>Only one warp profile can be active</done>
</task>

<task type="auto">
  <name>Add active warp indicator UI</name>
  <files>src/app/timeslicing/components/SuggestionCard.tsx, src/app/timeslicing/components/SuggestionPanel.tsx</files>
  <action>
    Show active warp status:
    1. Query useWarpSliceStore to check if suggestion's warp is currently active
    2. Add "Active" badge to accepted warp suggestion cards (green "ACTIVE" pill)
    3. Add tooltip: "This warp is currently applied to the timeline"
    4. When a different warp is accepted, update the active badge accordingly
    5. Add to panel header: "Active warp: [name]" or "No active warp"
  </action>
  <verify>Active warp shows green "ACTIVE" badge</verify>
  <done>Users can see which warp is currently active</done>
</task>

<task type="auto">
  <name>Add confirmation for warp replacement</name>
  <files>src/app/timeslicing/components/SuggestionCard.tsx</files>
  <action>
    Warn user when accepting will replace current warp:
    1. When hovering Accept button, check if there's an existing active warp
    2. If existing warp exists, show subtle warning:
       - "This will replace your current warp"
    3. Optionally: Add "Replace" vs "Cancel" confirmation for warp accepts
  </action>
  <verify>Warning shown before replacing active warp</verify>
  <done>Users understand accepting will replace current warp</done>
</task>

</tasks>

<verification>
- [ ] Only one warp active at a time
- [ ] Active warp shows badge
- [ ] Warning shown when replacing warp
</verification>

<success_criteria>
Single-warp constraint enforced with clear UI feedback
</success_criteria>

<output>
After completion, create `.planning/phases/37-algorithm-integration/37-08-SUMMARY.md`
</output>
