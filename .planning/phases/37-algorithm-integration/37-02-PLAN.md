---
phase: 37-algorithm-integration
plan: 02
type: execute
wave: 2
depends_on: [37-01]
files_modified:
  - src/store/useSuggestionStore.ts
  - src/app/timeslicing/components/SuggestionCard.tsx
  - src/app/timeslicing/components/SuggestionPanel.tsx
autonomous: true

must_haves:
  truths:
    - "Accepting warp profile creates warp slices on timeline"
    - "Accepting interval boundaries creates time slices"
    - "Modify button opens inline editing UI for the suggestion"
    - "Rejected suggestions are visually marked and excluded from timeline"
    - "Post-accept: suggestions removed from panel or archived"
  artifacts:
    - path: "src/store/useSuggestionStore.ts"
      provides: "Accept/reject state with callback handlers"
    - path: "src/app/timeslicing/components/SuggestionCard.tsx"
      provides: "Modify UI with inline editing controls"
  key_links:
    - from: "SuggestionCard accept action"
      to: "timeline store/warp slices"
      via: "onAccept callback that creates slices"
    - from: "SuggestionCard modify action"
      to: "SuggestionCard inline editor"
      via: "modifySuggestion store action"
---

<objective>
Implement accept/modify workflow - when users accept or modify suggestions, actually create slices on the timeline.

Purpose: Complete the review/approval loop. Suggestions are just proposals until accepted - this plan makes them real by creating actual warp slices and time slices on the timeline.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/37-algorithm-integration/37-CONTEXT.md

# Key decisions from CONTEXT.md:
- Accept Workflow for Warp Profiles: Apply to timeline immediately, create warp slice
- Accept Workflow for Interval Boundaries: Create time slices
- Accept Workflow - Post-Accept: Keep in panel (use default), remove from list (use default), or archive (use default) - Claude's discretion
- Modification - Re-scoring: Re-calculate on save
- Modification - Warp UI: Inline sliders on the card
- Modification - Interval UI: Inline list on the card

# Dependencies:
- Plan 37-01 must complete first (generation triggers, count configuration, visual distinction)
</context>

<tasks>

<task type="auto">
  <name>Implement warp profile accept workflow</name>
  <files>src/store/useSuggestionStore.ts, src/app/timeslicing/components/SuggestionCard.tsx</files>
  <action>
    When user accepts a warp profile suggestion:
    1. In acceptSuggestion action, check suggestion type
    2. If warp-profile: extract WarpProfileData (name, intervals with startPercent, endPercent, strength)
    3. Create actual warp slices in the timeline store (need to find existing slice store)
    4. Mark suggestion as accepted in store
    5. Optional: Remove from active suggestions list or keep with accepted status (use default: keep with status badge)
    
    Reference existing slice creation patterns in the codebase. Look at how manual slice creation works in phases 27-29.
  </action>
  <verify>Accepting warp profile suggestion creates actual warp slices visible on timeline</verify>
  <done>Warp profile accepted → warp slices appear on timeline</done>
</task>

<task type="auto">
  <name>Implement interval boundary accept workflow</name>
  <files>src/store/useSuggestionStore.ts, src/app/timeslicing/components/SuggestionCard.tsx</files>
  <action>
    When user accepts an interval boundary suggestion:
    1. In acceptSuggestion action, check suggestion type
    2. If interval-boundary: extract IntervalBoundaryData (boundaries array of epoch seconds)
    3. Convert boundaries to time slices (create slice for each boundary pair or single slice spanning all)
    4. Create actual time slices in the timeline store
    5. Mark suggestion as accepted in store
    
    Consider: Create separate slices for each boundary pair, or one slice spanning from first to last boundary.
  </action>
  <verify>Accepting interval boundary suggestion creates time slices on timeline</verify>
  <done>Interval boundary accepted → time slices appear on timeline</done>
</task>

<task type="auto">
  <name>Implement modify workflow with inline editing</name>
  <files>src/app/timeslicing/components/SuggestionCard.tsx</files>
  <action>
    Implement inline editing UI when user clicks Modify:
    1. When modifySuggestion is called, set suggestion to 'modified' status
    2. Show inline editing controls on the card (not a separate panel):
    
    For warp profiles:
    - Show list of intervals with sliders for startPercent, endPercent, strength
    - Allow adding/removing intervals
    - Save button to commit changes
    
    For interval boundaries:
    - Show list of boundary epoch values
    - Allow editing individual boundary values
    - Allow adding/removing boundaries
    - Save button to commit changes
    
    On save: call modifySuggestion with updated data, optionally re-calculate confidence
  </action>
  <verify>Clicking Modify shows inline editing controls, saving updates the suggestion</verify>
  <done>User can modify suggestion parameters inline and save changes</done>
</task>

<task type="auto">
  <name>Implement reject workflow</name>
  <files>src/store/useSuggestionStore.ts</files>
  <action>
    When user rejects a suggestion:
    1. Mark suggestion as 'rejected' status
    2. Visually de-emphasize in UI (already has styling in SuggestionCard)
    3. Exclude from timeline (don't create slices)
    4. Optionally: Auto-remove rejected after some time or keep until user clears all
    
    Rejected suggestions should NOT generate any timeline slices.
  </action>
  <verify>Rejecting suggestion marks it visually, no slices created</verify>
  <done>Rejected suggestions are marked and don't affect timeline</done>
</task>

</tasks>

<verification>
- [ ] Accepting warp profile creates warp slices on timeline
- [ ] Accepting interval boundaries creates time slices
- [ ] Modify button opens inline editing with sliders/inputs
- [ ] Saving modified suggestion updates data and re-calculates confidence
- [ ] Rejected suggestions are visually marked
- [ ] Accepted/rejected suggestions don't auto-generate new ones (only pending)
</verification>

<success_criteria>
- Accept workflow creates real slices on timeline
- Modify workflow allows editing suggestion parameters inline
- Reject workflow properly handles rejected suggestions
- Complete review/approval loop is functional
</success_criteria>

<output>
After completion, create `.planning/phases/37-algorithm-integration/37-02-SUMMARY.md`
</output>
