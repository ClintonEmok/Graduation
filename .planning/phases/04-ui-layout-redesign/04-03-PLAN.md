---
phase: 04-ui-layout-redesign
plan: 03
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/components/viz/CubeVisualization.tsx
  - src/app/layout-test/page.tsx
autonomous: true
must_haves:
  truths:
    - "Cube component renders 3D scene"
    - "Cube component resizes correctly without distortion"
    - "Map logic is removed from Cube component"
  artifacts:
    - path: "src/components/viz/CubeVisualization.tsx"
      provides: "3D panel content"
  key_links:
    - from: "src/components/viz/CubeVisualization.tsx"
      to: "src/components/viz/Scene.tsx"
      via: "import"
---

<objective>
Implement the 3D Cube Visualization component for the right panel.
Purpose: Provide the 3D temporal view.
Output: A reusable CubeVisualization component wired into the test layout.
</objective>

<context>
@src/components/viz/MainScene.tsx
</context>

<tasks>

<task type="auto">
  <name>Create CubeVisualization component</name>
  <files>src/components/viz/CubeVisualization.tsx</files>
  <action>
    Create `src/components/viz/CubeVisualization.tsx` based on `MainScene.tsx`.
    
    Modifications:
    1. Remove `MapBase` import and rendering.
    2. Remove `mode === 'map'` conditional logic (always render 3D scene).
    3. Keep data generation (`generateMockData`) and state.
    4. Keep `Scene`, `Grid`, `DataPoints`, `TimePlane`, `TimeLoop`, `Controls`.
    5. Wrap everything in a div with `className="w-full h-full relative overflow-hidden"`.
       - This handles the "Pitfall 1: R3F Canvas Not Resizing" from research.
  </action>
  <verify>
    File exists and imports Scene but NOT MapBase.
  </verify>
  <done>
    Component created with 3D-only logic.
  </done>
</task>

<task type="auto">
  <name>Update verification route</name>
  <files>src/app/layout-test/page.tsx</files>
  <action>
    Update `src/app/layout-test/page.tsx`.
    - Import `CubeVisualization`.
    - Replace the blue placeholder div in `vizSlot` with `<CubeVisualization />`.
  </action>
  <verify>
    grep "CubeVisualization" src/app/layout-test/page.tsx
  </verify>
  <done>
    Test route now renders the 3D scene.
  </done>
</task>

</tasks>

<verification>
Check for type errors (note: copy existing types carefully).
</verification>

<success_criteria>
- [ ] CubeVisualization component created
- [ ] Test page renders CubeVisualization
- [ ] No map logic in CubeVisualization
</success_criteria>

<output>
After completion, create .planning/phases/04-ui-layout-redesign/04-03-SUMMARY.md
</output>
