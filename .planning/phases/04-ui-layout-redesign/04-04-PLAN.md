---
phase: 04-ui-layout-redesign
plan: 04
type: execute
wave: 3
depends_on: [04-02, 04-03]
files_modified:
  - src/components/timeline/TimelinePanel.tsx
  - src/components/viz/CubeVisualization.tsx
  - src/app/page.tsx
  - src/app/layout-test/page.tsx
autonomous: true
must_haves:
  truths:
    - "Timeline panel renders at the bottom"
    - "Timeline controls are functional"
    - "Main page displays the full 3-pane layout"
    - "Reset view button is available"
  artifacts:
    - path: "src/components/timeline/TimelinePanel.tsx"
      provides: "Timeline content"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/layout/DashboardLayout.tsx"
      via: "render"
---

<objective>
Finalize the UI layout by implementing the Timeline panel and assembling the full dashboard.
Purpose: Complete the transition to the new 3-pane design and restore full application functionality.
Output: The main route (/) running the new layout with all 3 components active.
</objective>

<context>
@src/components/ui/TimeControls.tsx
@src/components/ui/Overlay.tsx
</context>

<tasks>

<task type="auto">
  <name>Create TimelinePanel component</name>
  <files>src/components/timeline/TimelinePanel.tsx</files>
  <action>
    Create `src/components/timeline/TimelinePanel.tsx` based on `src/components/ui/TimeControls.tsx`.
    
    Modifications:
    1. Copy logic and UI from `TimeControls`.
    2. Remove fixed positioning classes (`fixed bottom-0 left-0 right-0 z-50 backdrop-blur`).
    3. Update container styling to fill the panel (`w-full h-full bg-background border-t p-4 flex flex-col justify-center`).
    4. Ensure it adapts to the panel height (use `h-full` and flexbox).
  </action>
  <verify>
    File exists and does not contain "fixed bottom-0".
  </verify>
  <done>
    Timeline panel created suitable for embedding.
  </done>
</task>

<task type="auto">
  <name>Add Reset Button to CubeVisualization</name>
  <files>src/components/viz/CubeVisualization.tsx</files>
  <action>
    Update `src/components/viz/CubeVisualization.tsx` to include the Reset View button.
    
    Implementation:
    - Import `RefreshCcw` from `lucide-react` and `useUIStore`.
    - Add an absolute positioned button (top-right of the panel) that calls `triggerReset`.
    - Style: `absolute top-4 right-4 z-10 ...` (similar to original Overlay).
  </action>
  <verify>
    grep "triggerReset" src/components/viz/CubeVisualization.tsx
  </verify>
  <done>
    Reset functionality restored in the 3D view.
  </done>
</task>

<task type="auto">
  <name>Assemble Main Dashboard</name>
  <files>src/app/page.tsx</files>
  <action>
    Update `src/app/page.tsx` to use the new layout.
    
    Implementation:
    - Import `DashboardLayout`, `MapVisualization`, `CubeVisualization`, `TimelinePanel`.
    - Replace existing content (`MainScene`, `Overlay`, `TimeControls`) with:
      ```tsx
      <main className="h-screen w-screen overflow-hidden bg-black text-white">
        <DashboardLayout
          mapSlot={<MapVisualization />}
          vizSlot={<CubeVisualization />}
          timelineSlot={<TimelinePanel />}
        />
      </main>
      ```
  </action>
  <verify>
    grep "DashboardLayout" src/app/page.tsx
  </verify>
  <done>
    Main route updated to new layout.
  </done>
</task>

<task type="auto">
  <name>Cleanup Verification Artifacts</name>
  <files>src/app/layout-test/page.tsx</files>
  <action>
    Delete the temporary test directory `src/app/layout-test` and its contents.
  </action>
  <verify>
    [ ! -d "src/app/layout-test" ]
  </verify>
  <done>
    Cleanup complete.
  </done>
</task>

</tasks>

<verification>
Verify build success and no lingering imports of `MainScene` in `page.tsx`.
</verification>

<success_criteria>
- [ ] Timeline panel works in bottom slot
- [ ] Main page renders 3-pane layout
- [ ] Reset button visible in Cube panel
- [ ] No regression in functionality (map loads, cube loads, time controls work)
</success_criteria>

<output>
After completion, create .planning/phases/04-ui-layout-redesign/04-04-SUMMARY.md
</output>
