---
phase: 13-ui-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/settings/SettingsPanel.tsx
  - src/components/layout/DashboardLayout.tsx
  - src/components/layout/ErrorBoundary.tsx
autonomous: true
gap_closure: true
must_haves:
  truths:
    - "Settings save triggers a toast notification"
    - "Data loading shows a spinner overlay"
    - "Critical errors show a dialog instead of crashing"
  artifacts:
    - path: "src/components/settings/SettingsPanel.tsx"
      provides: "Toast integration"
    - path: "src/components/layout/DashboardLayout.tsx"
      provides: "Layout with feedback overlays"
    - path: "src/components/layout/ErrorBoundary.tsx"
      provides: "Error catching logic"
  key_links:
    - from: "SettingsPanel.tsx"
      to: "sonner"
      via: "toast()"
    - from: "DashboardLayout.tsx"
      to: "useDataStore"
      via: "isLoading selector"
---

<objective>
Close feedback gaps identified in UAT:
1. Missing toast notifications on settings save
2. Missing loading overlay during data fetch
3. Missing error boundary for graceful failure handling

Purpose: Ensure users receive immediate feedback for actions and system states.
Output: Integrated feedback components (Toast, Loader, ErrorDialog).
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-ui-polish/13-UAT.md
@src/components/settings/SettingsPanel.tsx
@src/components/layout/DashboardLayout.tsx
@src/store/useDataStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Toast in SettingsPanel</name>
  <files>src/components/settings/SettingsPanel.tsx</files>
  <action>
    Modify SettingsPanel.tsx to use 'sonner' for feedback:
    1. Import { toast } from 'sonner'
    2. In handleSave(), add toast.success("Settings saved successfully")
    3. In handleCopyShare(), add toast.success("Share URL copied to clipboard")
    4. In handleReset(), add toast.info("Settings reset to defaults")
  </action>
  <verify>
    grep "toast.success" src/components/settings/SettingsPanel.tsx
  </verify>
  <done>
    User actions in settings panel trigger appropriate toast notifications.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate LoadingOverlay</name>
  <files>src/components/layout/DashboardLayout.tsx</files>
  <action>
    Connect LoadingOverlay to the global data loading state:
    1. Import { LoadingOverlay } from '@/components/ui/loading-overlay'
    2. Import { useDataStore } from '@/store/useDataStore'
    3. Get { isLoading } from useDataStore hook
    4. Add <LoadingOverlay isLoading={isLoading} message="Loading data..." /> as the last child of the main container
    
    Ensure the overlay has high z-index (check component def if needed, or wrap in div with z-50).
  </action>
  <verify>
    grep "LoadingOverlay" src/components/layout/DashboardLayout.tsx
  </verify>
  <done>
    LoadingOverlay appears whenever useDataStore.isLoading is true.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement and Integrate ErrorBoundary</name>
  <files>src/components/layout/ErrorBoundary.tsx, src/components/layout/DashboardLayout.tsx</files>
  <action>
    1. Create src/components/layout/ErrorBoundary.tsx:
       - Class component wrapping children
       - State: { hasError: boolean, error: Error | null }
       - static getDerivedStateFromError(error): returns { hasError: true, error }
       - componentDidCatch(error, errorInfo): log to console
       - render():
         - If hasError: Render <ErrorDialog isOpen={true} title="Application Error" description={error.message} onClose={() => this.setState({ hasError: false })} />
         - Else: Render children
    
    2. Import ErrorBoundary in DashboardLayout.tsx
    3. Wrap the main layout content (inside the return) with <ErrorBoundary>
  </action>
  <verify>
    test -f src/components/layout/ErrorBoundary.tsx && grep "ErrorBoundary" src/components/layout/DashboardLayout.tsx
  </verify>
  <done>
    App is protected by a top-level error boundary that displays the ErrorDialog.
  </done>
</task>

</tasks>

<verification>
Manual verification required (visual):
1. Open settings -> Save -> Verify toast
2. Refresh page -> Verify loading spinner appears briefly
3. (Optional) Temporarily throw error in a component -> Verify ErrorDialog
</verification>

<success_criteria>
- [ ] Settings actions trigger toasts
- [ ] Data loading shows visual feedback
- [ ] Runtime errors are caught and displayed gracefully
</success_criteria>

<output>
After completion, create .planning/phases/13-ui-polish/13-04-SUMMARY.md
</output>
