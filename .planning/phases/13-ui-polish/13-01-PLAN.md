---
phase: 13-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/loading-overlay.tsx
  - src/components/ui/error-dialog.tsx
  - src/components/layout/DashboardLayout.tsx
  - src/app/layout.tsx
autonomous: true
must_haves:
  truths:
    - "User sees a skeleton loader while data is fetching"
    - "User sees a toast notification for non-critical actions"
    - "User sees a modal dialog for critical errors"
  artifacts:
    - path: "src/components/ui/loading-overlay.tsx"
      provides: "Global loading state with Skeleton"
    - path: "src/components/ui/error-dialog.tsx"
      provides: "Critical error modal"
  key_links:
    - from: "src/components/layout/DashboardLayout.tsx"
      to: "src/components/ui/sonner.tsx"
      via: "<Toaster /> component"
---

<objective>
Establish the feedback infrastructure for the application, including loading states, error handling, and toast notifications.

Purpose: Ensure users always know the system status (loading, error, success) to prevent confusion during async operations.
Output: Integrated `Toaster`, `LoadingOverlay`, and `ErrorDialog` components.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-ui-polish/13-RESEARCH.md
@src/components/layout/DashboardLayout.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Feedback Dependencies</name>
  <files>package.json, components.json</files>
  <action>
    Install required shadcn/ui components and libraries:
    1. Run `npx shadcn@latest add skeleton dialog button`
    2. Install `sonner` via `npx shadcn@latest add sonner` (this creates src/components/ui/sonner.tsx)
    3. Ensure `lucide-react` is available for icons (Loader2, AlertTriangle).
  </action>
  <verify>
    ls src/components/ui/skeleton.tsx src/components/ui/dialog.tsx src/components/ui/sonner.tsx
  </verify>
  <done>
    Components installed in src/components/ui/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Feedback Components</name>
  <files>src/components/ui/loading-overlay.tsx, src/components/ui/error-dialog.tsx</files>
  <action>
    1. Create `src/components/ui/loading-overlay.tsx`:
       - Export `LoadingOverlay` component.
       - Accept `isLoading` prop (boolean).
       - Use `Skeleton` to mimic the 3-pane layout (Sidebar, Map, Timeline) or a centered `Loader2` spinner with backdrop.
       - Use `z-50` to overlay content if needed, or structured skeletons for initial load.
       - Prefer structured skeletons for "initial load" and spinner overlay for "busy state".
    
    2. Create `src/components/ui/error-dialog.tsx`:
       - Export `ErrorDialog` component.
       - Uses `AlertDialog` or `Dialog` from shadcn.
       - Props: `isOpen`, `title`, `description`, `onClose`, `technicalDetails` (optional).
       - Render a clean error message with a "Dismiss" or "Retry" button.
       - If `technicalDetails` is present, put it in a collapsed section (details/summary).
  </action>
  <verify>
    Check file existence and imports.
  </verify>
  <done>
    `LoadingOverlay` and `ErrorDialog` components exist and compile.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate into Layout</name>
  <files>src/components/layout/DashboardLayout.tsx</files>
  <action>
    Modify `src/components/layout/DashboardLayout.tsx`:
    1. Import `Toaster` from `src/components/ui/sonner`.
    2. Add `<Toaster />` at the root of the layout (inside the main div).
    3. Import `LoadingOverlay`.
    4. (Optional) Add a temporary test button or effect to verify Toaster works (remove before finishing if verified manually).
    5. Ensure `Toaster` is positioned correctly (usually bottom-right or top-right).
  </action>
  <verify>
    grep "Toaster" src/components/layout/DashboardLayout.tsx
  </verify>
  <done>
    Layout includes Toaster and is ready for global feedback.
  </done>
</task>

</tasks>

<verification>
- Run `npm run build` to ensure no type errors with new components.
- Check that `Toaster` is present in the layout tree.
</verification>

<success_criteria>
- `sonner`, `skeleton`, `dialog` installed.
- `LoadingOverlay` component created.
- `ErrorDialog` component created.
- `Toaster` integrated into DashboardLayout.
</success_criteria>

<output>
After completion, create `.planning/phases/13-ui-polish/13-01-SUMMARY.md`
</output>
