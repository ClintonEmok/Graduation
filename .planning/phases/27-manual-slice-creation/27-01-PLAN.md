---
phase: 27-manual-slice-creation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/timeline-test/page.tsx
  - src/app/timeline-test/components/SliceToolbar.tsx
  - src/store/useSliceCreationStore.ts
  - src/app/timeline-test/components/SliceList.tsx
autonomous: true
must_haves:
  truths:
    - User can toggle between view mode and create-slice mode
    - Mode toggle provides clear visual feedback (amber highlight when active)
    - Transient Zustand store exists for creation state management
    - Created slices appear in a list with delete capability
    - New slices are automatically selected and named
  artifacts:
    - path: src/store/useSliceCreationStore.ts
      provides: Transient creation state (mode, preview, ghost position)
      exports: [useSliceCreationStore, SliceCreationState]
    - path: src/app/timeline-test/components/SliceToolbar.tsx
      provides: Mode toggle UI with visual indicators
      min_lines: 50
    - path: src/app/timeline-test/components/SliceList.tsx
      provides: List of created slices with delete
      min_lines: 40
  key_links:
    - from: SliceToolbar
      to: useSliceCreationStore
      via: startCreation/cancelCreation actions
      pattern: useSliceCreationStore\(state\)
    - from: useSliceCreationStore
      to: useSliceStore
      via: commitCreation adds to persisted store
      pattern: useSliceStore.getState\(\).addSlice
---

<objective>
Establish the foundational infrastructure for manual slice creation: mode toggle system, transient Zustand store for ephemeral creation state, and UI controls. This creates the mode-based interaction foundation that subsequent plans will build upon.

Purpose: Enable users to enter/exit slice creation mode with clear visual feedback, and manage the transient state (preview, ghost position) separately from persisted slices.
Output: Mode toggle in toolbar, transient creation store, slice list component, working in /timeline-test
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/27-manual-slice-creation/27-CONTEXT.md
@.planning/phases/27-manual-slice-creation/27-RESEARCH.md
@src/store/useSliceStore.ts
@src/app/timeline-test/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create transient slice creation store</name>
  <files>src/store/useSliceCreationStore.ts</files>
  <action>
Create a new Zustand store for ephemeral slice creation state. This store is NOT persisted (no persist middleware). Follow the pattern from RESEARCH.md Pattern 4.

Interface requirements:
- isCreating: boolean - whether we're in creation mode
- creationMode: 'click' | 'drag' | null - which creation mode is active
- previewStart: number | null - normalized time (0-100) of preview start
- previewEnd: number | null - normalized time (0-100) of preview end
- ghostPosition: { x: number; width: number } | null - pixel position for ghost rendering

Actions:
- startCreation(mode: 'click' | 'drag') - enters creation mode, resets preview state
- updatePreview(start: number, end: number) - updates preview times and ghost position
- commitCreation() -> TimeSlice | null - finalizes creation, adds to useSliceStore, resets state
- cancelCreation() - exits creation mode without creating, resets all transient state

Important: The commitCreation action should:
1. Check if previewStart is null - return null if so
2. Generate auto-named slice (format: "Slice {n+1}")
3. Call useSliceStore.getState().addSlice() with proper TimeSlice format
4. The addSlice in useSliceStore already sets activeSliceId automatically
5. Reset transient state and return the created slice

Export both the hook (useSliceCreationStore) and the type (SliceCreationState) for TypeScript usage.
  </action>
  <verify>Store compiles without errors, imports work in other files</verify>
  <done>Transient store exists with all required state and actions, TypeScript types exported</done>
</task>

<task type="auto">
  <name>Task 2: Create mode toggle toolbar component</name>
  <files>src/app/timeline-test/components/SliceToolbar.tsx</files>
  <action>
Create a toolbar component for mode toggling and slice management. Follow RESEARCH.md Pattern 1 for mode-based UI.

Requirements:
- Primary action button: "Create Slice" / "Cancel" toggle
  - When not creating: shows Scissors icon + "Create Slice" text, slate styling
  - When creating: shows amber background/border, "Cancel" text, active indicator
- Active mode indicator: When in create mode, show amber badge "Active" and helper text "Click or drag on timeline"
- Slice counter: Show count of existing slices when > 0
- Clear all button: Trash icon to clear all slices (calls useSliceStore.clearSlices())

Styling:
- Container: bg-slate-900/80, border-slate-700, rounded-lg, p-2
- Button transitions: transition-all for smooth state changes
- Amber theme for active state: bg-amber-500/20, text-amber-300, border-amber-500/50
- Use Lucide icons: Scissors, Trash2

Connect to stores:
- useSliceCreationStore for isCreating, startCreation, cancelCreation
- useSliceStore for slices array, clearSlices

The component should be purely presentational - all logic comes from stores.
  </action>
  <verify>Component renders without errors, buttons respond to clicks, visual state changes correctly</verify>
  <done>Toolbar component exists with mode toggle, visual feedback, and slice management</done>
</task>

<task type="auto">
  <name>Task 3: Create slice list and integrate into test page</name>
  <files>src/app/timeline-test/components/SliceList.tsx, src/app/timeline-test/page.tsx</files>
  <action>
Create a slice list component showing created slices and integrate everything into the timeline test page.

SliceList component requirements:
- Display each slice with:
  - Auto-generated name ("Slice 1", "Slice 2", etc.)
  - Time range (formatted as readable dates)
  - Visual indicator if slice is selected (activeSliceId check)
  - Delete button (X icon) per slice
- Empty state: "No slices created yet" message when slices array is empty
- Use useSliceStore for slices, activeSliceId, removeSlice, setActiveSlice

Page integration (timeline-test/page.tsx):
- Import and add SliceToolbar at the top of the section (after header, before density charts)
- Import and add SliceList below the DualTimeline component
- The existing test page structure should remain intact
- Ensure proper spacing between components

Testing integration:
- Verify clicking "Create Slice" enters creation mode (visual state change)
- Verify clicking "Cancel" exits creation mode
- Create a test slice manually (via browser console calling store actions) to verify list renders
- Verify delete works in the list

This sets up the foundation for actual slice creation interaction in Plan 02.
  </action>
  <verify>Toolbar and list render correctly, mode toggle works visually, list shows slices</verify>
  <done>Test page has working mode toggle, slice list, and visual feedback for creation mode</done>
</task>

</tasks>

<verification>
- [ ] Mode toggle switches visual state between view and create-slice modes
- [ ] Create mode shows amber "Active" indicator and helper text
- [ ] Transient store manages isCreating, creationMode, preview state separately from persisted slices
- [ ] Slice list displays auto-named slices with time ranges
- [ ] Slice list shows empty state when no slices exist
- [ ] Delete button removes slice from list
- [ ] All components compile without TypeScript errors
</verification>

<success_criteria>
Foundation complete when:
1. User can toggle between view and create-slice modes with clear visual feedback
2. Transient creation state is isolated in useSliceCreationStore (not persisted)
3. Slice list displays existing slices with auto-generated names
4. Mode toggle and slice list are integrated into /timeline-test page
5. No console errors or TypeScript warnings
</success_criteria>

<output>
After completion, create `.planning/phases/27-manual-slice-creation/27-01-SUMMARY.md`
</output>
