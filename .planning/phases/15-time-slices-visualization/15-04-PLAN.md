---
phase: 15-time-slices-visualization
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/ui/calendar.tsx
  - src/components/ui/popover.tsx
  - src/store/useSliceStore.ts
  - src/components/viz/SliceManagerUI.tsx
autonomous: true
must_haves:
  truths:
    - "User can see a Calendar popup when adding a slice"
    - "User can select a single date or a date range"
    - "Selected dates are stored as normalized values in the store"
  artifacts:
    - path: "src/components/ui/calendar.tsx"
      provides: "Calendar component"
    - path: "src/components/ui/popover.tsx"
      provides: "Popover component"
    - path: "src/store/useSliceStore.ts"
      contains: "type: 'point' | 'range'"
  key_links:
    - from: "src/components/viz/SliceManagerUI.tsx"
      to: "src/components/ui/calendar.tsx"
      via: "import"
---

<objective>
Refactor Time Slice UX to use Date Pickers instead of number inputs.
Purpose: Improve usability by allowing users to select slices using natural date controls.
Output: Updated UI components and Store supporting both point and range slices.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/15-time-slices-visualization/15-03-SUMMARY.md
@src/components/viz/SliceManagerUI.tsx
@src/store/useSliceStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Dependencies and Add UI Components</name>
  <files>package.json, src/components/ui/calendar.tsx, src/components/ui/popover.tsx</files>
  <action>
    1. Install `date-fns` and `react-day-picker` using `npm install`.
    2. Create `src/components/ui/calendar.tsx` using standard shadcn/ui implementation (using `react-day-picker`).
    3. Create `src/components/ui/popover.tsx` using standard shadcn/ui implementation (using `@radix-ui/react-popover`).
    Ensure components export `Calendar` and `Popover` properly.
  </action>
  <verify>
    Check if files exist and `npm list` shows new dependencies.
  </verify>
  <done>
    Calendar and Popover components created and dependencies installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor Slice Store</name>
  <files>src/store/useSliceStore.ts</files>
  <action>
    Update `TimeSlice` interface:
    - Add `type: 'point' | 'range'` (default 'point').
    - Add `range?: [number, number]` (normalized start/end).
    - Keep `time` for 'point' type.
    
    Update store actions:
    - `addSlice(initial: Partial<TimeSlice>)` to support creating ranges.
    - `updateSlice` handles both time and range updates.
    
    Ensure backward compatibility or migrate existing slices (clearSlices on init if needed).
  </action>
  <verify>
    Create a test script to add both point and range slices to the store.
  </verify>
  <done>
    Store supports both slice types.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Slice Manager UI</name>
  <files>src/components/viz/SliceManagerUI.tsx</files>
  <action>
    Refactor `SliceManagerUI` to replace number inputs with Date controls:
    - Use `Popover` + `Calendar` for date selection.
    - For 'point' slices: Show single date picker.
    - For 'range' slices: Show date range picker.
    - Add a toggle or separate buttons to "Add Date Slice" vs "Add Range Slice".
    - Convert selected Dates to normalized values (0-100) using `epochSecondsToNormalized` (import from `src/lib/time-domain`).
    - Display dates nicely formatted using `date-fns` (e.g., `format(date, "PPP")`).
  </action>
  <verify>
    Verify `npm run build` succeeds (TS checks).
  </verify>
  <done>
    UI allows adding and editing date-based slices.
  </done>
</task>

</tasks>

<verification>
Ensure the application builds and the UI opens the calendar.
</verification>

<success_criteria>
1. User can add a point slice via Date Picker.
2. User can add a range slice via Range Picker.
3. Dates are correctly converted to/from normalized store values.
</success_criteria>

<output>
After completion, create `.planning/phases/15-time-slices-visualization/15-04-SUMMARY.md`
</output>
