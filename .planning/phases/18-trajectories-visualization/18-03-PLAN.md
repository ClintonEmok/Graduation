---
phase: 18-trajectories-visualization
plan: 03
type: execute
wave: 3
depends_on: ["18-02"]
files_modified: [src/components/viz/Trajectory.tsx, src/components/viz/TrajectoryTooltip.tsx, src/store/useTrajectoryStore.ts]
autonomous: true

must_haves:
  truths:
    - "Hovering a trajectory shows duration and geographic distance in a tooltip"
    - "Non-selected trajectories are ghosted when a selection exists"
    - "Clicking a trajectory selects all associated points"
  artifacts:
    - path: "src/components/viz/TrajectoryTooltip.tsx"
      provides: "Trajectory summary information"
  key_links:
    - from: "src/components/viz/Trajectory.tsx"
      to: "src/components/viz/TrajectoryTooltip.tsx"
      via: "conditional rendering on hover"
---

<objective>
Enhance trajectory exploration with detailed interaction, summary tooltips, and selection isolation.

Purpose: Provide users with quantitative insights into trajectories (duration, distance) and reduce visual clutter through selection-centric ghosting.
Output: Interactive 3D trajectories with informative tooltips and isolation logic.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-trajectories-visualization/18-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Interactive Selection & Ghosting</name>
  <files>src/components/viz/Trajectory.tsx, src/store/useTrajectoryStore.ts</files>
  <action>
    - Add `onPointerOver`, `onPointerOut`, and `onClick` to `Trajectory.tsx`.
    - Update `useTrajectoryStore` actions to set `hoveredBlock` and `selectedBlock`.
    - Implement ghosting: If `selectedBlock` is not null, trajectories that don't match the selected block should render with drastically reduced opacity (e.g., 0.1).
    - Ensure clicking a trajectory also selects associated points in `useCoordinationStore`.
  </action>
  <verify>Hover and click on trajectories; confirm store updates and non-selected paths fade out.</verify>
  <done>Trajectories are interactive and support isolation.</done>
</task>

<task type="auto">
  <name>Task 2: Summary Tooltip Component</name>
  <files>src/components/viz/TrajectoryTooltip.tsx, src/components/viz/Trajectory.tsx</files>
  <action>
    - Create `TrajectoryTooltip.tsx` (using HTML overlay from `@react-three/drei`).
    - Calculate trajectory duration (max time - min time) and geographic "travel" distance (sum of Euclidean distances between points on XZ plane).
    - Display these values in a styled tooltip that appears at the pointer position when hovering.
  </action>
  <verify>Hover over a trajectory and confirm the tooltip shows duration and distance.</verify>
  <done>Users receive quantitative feedback on trajectories.</done>
</task>

</tasks>

<verification>
Verify tooltip displays correct duration/distance.
Confirm ghosting logic works when a block is selected.
Check selection sync with global point selection.
</verification>

<success_criteria>
- Tooltip visible on hover with duration/distance.
- Unselected trajectories fade out on click.
- Associated points are highlighted on selection.
</success_criteria>

<output>
After completion, create `.planning/phases/18-trajectories-visualization/18-03-SUMMARY.md`
</output>
