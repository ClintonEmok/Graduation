---
phase: 01-core-3d-visualization
plan: 02
type: execute
wave: 2
depends_on: [01-01]
files_modified: [src/components/viz/Scene.tsx, src/components/viz/Controls.tsx, src/components/viz/Grid.tsx]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Scene renders a 3D canvas"
    - "User can orbit and zoom the camera"
    - "Grid and Axes helpers are visible"
    - "Background is dark (black)"
  artifacts:
    - path: "src/components/viz/Scene.tsx"
      provides: "R3F Canvas wrapper"
      contains: "<Canvas"
    - path: "src/components/viz/Controls.tsx"
      provides: "Navigation logic"
      contains: "CameraControls"
    - path: "src/components/viz/Grid.tsx"
      provides: "Visual reference"
      contains: "GridHelper"
  key_links:
    - from: "src/components/viz/Scene.tsx"
      to: "src/components/viz/Controls.tsx"
      via: "composition"
      pattern: "<Controls"
---

<objective>
Implement the core abstract 3D environment using React Three Fiber.

Purpose: Provide the visual container for the Space-Time Cube.
Output: A reusable `Scene` component with navigation controls and spatial reference helpers.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-core-3d-visualization/01-RESEARCH.md
@.planning/phases/01-core-3d-visualization/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Scene Container</name>
  <files>src/components/viz/Scene.tsx</files>
  <action>
    Create `src/components/viz/Scene.tsx`.
    - Export a `Scene` component that renders a `<Canvas>` from `@react-three/fiber`.
    - Configure the camera: position `[50, 50, 50]`, fov `45`.
    - Set the background color to black (`#000000`) using `<color attach="background" args={['#000000']} />`.
    - Accept `children` prop to allow composing content later.
  </action>
  <verify>Check file exists and imports Canvas correctly.</verify>
  <done>Scene component is created.</done>
</task>

<task type="auto">
  <name>Task 2: Implement Navigation Controls</name>
  <files>src/components/viz/Controls.tsx</files>
  <action>
    Create `src/components/viz/Controls.tsx`.
    - Use `CameraControls` from `@react-three/drei` (as per Research/Decisions).
    - Configure `smoothTime={0.25}` for fluid movement.
    - Expose a `ref` if needed, or just auto-mount it.
    - Set `minDistance={1}` and `maxDistance={500}` to constrain zoom (VIS-context).
    - Set `maxPolarAngle={Math.PI / 2}` to prevent going under the floor.
  </action>
  <verify>Check usage of CameraControls from drei.</verify>
  <done>Controls component is defined with constraints.</done>
</task>

<task type="auto">
  <name>Task 3: Add Visual Helpers</name>
  <files>src/components/viz/Grid.tsx</files>
  <action>
    Create `src/components/viz/Grid.tsx`.
    - Render a `GridHelper` (size 200, divisions 20, colorCenter 'cyan', colorGrid 'gray').
    - Render an `AxesHelper` (size 10).
    - Position grid at `[0, 0, 0]`.
  </action>
  <verify>Check standard three.js helper usage.</verify>
  <done>Grid and Axes helpers are wrapped in a component.</done>
</task>

</tasks>

<verification>
No visual verification in this plan (components are unmounted). Code structure verification only.
</verification>

<success_criteria>
- Scene component encapsulates R3F Canvas setup.
- Controls are configured with constraints (no going underground).
- Grid/Axes helpers are ready to provide spatial context.
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-3d-visualization/01-02-SUMMARY.md`
</output>
