---
phase: 01-core-3d-visualization
plan: 04
type: execute
wave: 2
depends_on: [01-01]
files_modified: [src/components/map/MapBase.tsx, src/lib/projection.ts]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Map component is configured with MapLibre"
    - "Dark mode style is applied to the map"
    - "Projection utilities can convert Lat/Lon to World coordinates"
  artifacts:
    - path: "src/components/map/MapBase.tsx"
      provides: "Geospatial view"
      contains: "react-map-gl"
    - path: "src/lib/projection.ts"
      provides: "Coordinate conversion"
      contains: "project"
  key_links:
    - from: "src/components/map/MapBase.tsx"
      to: "src/lib/projection.ts"
      via: "import"
      pattern: "import"
---

<objective>
Establish the geospatial foundation using MapLibre GL JS and projection utilities.

Purpose: Provide the "Map View" capability and the math to align 3D points with geographic coordinates.
Output: A Map component and a projection utility library.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-core-3d-visualization/01-RESEARCH.md
@.planning/phases/01-core-3d-visualization/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Projection Utilities</name>
  <files>src/lib/projection.ts</files>
  <action>
    Create `src/lib/projection.ts`.
    - Use `@math.gl/web-mercator` or simple Mercator math.
    - Define a `CENTER` constant (Lat/Lon for Chicago: `[41.8781, -87.6298]`).
    - Implement `project(lat: number, lon: number): [x, z]` function.
    - Ensure the output is centered relative to the `CENTER` (so Chicago downtown is 0,0).
    - Scale appropriately (e.g., meters or arbitrary units).
  </action>
  <verify>Check math logic ensures center lat/lon projects to 0,0.</verify>
  <done>Projection utility helps align data.</done>
</task>

<task type="auto">
  <name>Task 2: Implement Map Component</name>
  <files>src/components/map/MapBase.tsx</files>
  <action>
    Create `src/components/map/MapBase.tsx`.
    - Use `Map` from `react-map-gl/maplibre`.
    - Set `initialViewState` to Chicago (`latitude: 41.8781, longitude: -87.6298, zoom: 12`).
    - Use `mapStyle="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"` (Dark Matter).
    - Ensure the map fills the parent container.
    - Import `maplibre-gl/dist/maplibre-gl.css`.
  </action>
  <verify>Check import of CSS and correct component usage.</verify>
  <done>MapBase component is ready.</done>
</task>

</tasks>

<verification>
Code structure check.
</verification>

<success_criteria>
- Projection logic allows converting geospatial data to scene coordinates.
- Map component is configured with a dark theme and Chicago focus.
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-3d-visualization/01-04-SUMMARY.md`
</output>
