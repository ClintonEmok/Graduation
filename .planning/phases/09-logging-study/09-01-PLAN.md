---
phase: 09
plan: 01
type: auto
autonomous: true
---

# Plan: Logging Infrastructure

## Objective
Implement a robust logging system to capture user interactions, view changes, and system events for the user study. Logs must be structured, timestamped, and exportable for analysis.

## Context
To evaluate the effectiveness of the Adaptive Space-Time Cube, we need to track how users interact with the system. This requires a centralized logging service that components can use to record "events" (e.g., "filter_changed", "camera_moved", "mode_toggled").

## Tasks

- [ ] **Task 1: Create Logger Service**
  - Define `LogEntry` interface (timestamp, eventType, details, sessionId).
  - Create `Logger` class/singleton to buffer and flush logs.
  - Create `useLogger` hook for React components.

- [ ] **Task 2: Create Server-Side Logger**
  - Create API route `/api/study/log` to receive batches of logs.
  - Implement file writing (NDJSON) to `logs/study-sessions.jsonl`.
  - Ensure logs are appended safely.

- [ ] **Task 3: Instrument Key Components**
  - Log `VIEW_CHANGE` (Map vs Cube vs Abstract).
  - Log `MODE_CHANGE` (Uniform vs Adaptive).
  - Log `FILTER_CHANGE` (Type, District, Time Range).
  - Log `INTERACTION` (Click, Hover, Tooltip).
  - Log `CAMERA_MOVE` (Throttled position updates).

- [ ] **Task 4: Session Management (Basic)**
  - Create `useStudyStore` to manage `sessionId` and `participantId`.
  - Generate UUID for new sessions.
  - Attach `sessionId` to all logs.

## Verification
- **Automated**: Test `Logger` buffering and flushing.
- **Manual**:
  1. Open app.
  2. Interact with map, timeline, filters.
  3. Check `logs/study-sessions.jsonl` (or similar) to see structured events.

## Output
- `src/lib/logger.ts`
- `src/hooks/useLogger.ts`
- `src/store/useStudyStore.ts`
- `src/app/api/study/log/route.ts`
- Instrumented components.
