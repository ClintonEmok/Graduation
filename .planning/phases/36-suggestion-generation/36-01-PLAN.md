---
phase: 36-suggestion-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/lib/confidence-scoring.ts]
autonomous: true

must_haves:
  truths:
    - "Confidence scores calculated from data characteristics"
    - "Score range 0-100% matches ConfidenceBadge format"
  artifacts:
    - path: "src/lib/confidence-scoring.ts"
      provides: "Confidence calculation functions"
      exports: ["calculateConfidence", "calculateDataClarity", "calculateCoverage", "calculateStatisticalConfidence"]
---

<objective>
Create confidence scoring module that calculates 0-100% confidence scores for suggestions based on data characteristics.

Purpose: Foundation module used by both warp profile and interval boundary generation. Composite scoring combines data clarity, coverage, and statistical measures per CONTEXT.md decisions.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/35-semi-automated-timeslicing-workflows/35-01-SUMMARY.md
@src/store/useSuggestionStore.ts
@src/types/crime.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create confidence-scoring.ts module</name>
  <files>src/lib/confidence-scoring.ts</files>
  <action>
    Create src/lib/confidence-scoring.ts with the following exports:

    1. `calculateDataClarity(crimes: CrimeRecord[], timeRange: {start: number, end: number}): number`
       - Measures how "clean" the data signal is
       - Look at variance in crime density over time
       - Higher variance (distinct peaks/valleys) = clearer signal = higher clarity
       - Returns 0-100 score

    2. `calculateCoverage(crimes: CrimeRecord[], timeRange: {start: number, end: number}): number`
       - Measures data coverage in the time range
       - Factor in: record count, temporal distribution, gaps in data
       - More uniform coverage = higher score
       - Returns 0-100 score

    3. `calculateStatisticalConfidence(densityBins: number[]): number`
       - Measures statistical significance of patterns
       - Use: signal-to-noise ratio, peak prominence, distribution characteristics
       - Stronger, more distinct patterns = higher confidence
       - Returns 0-100 score

    4. `calculateConfidence(options: {crimes: CrimeRecord[], timeRange: {start: number, end: number}, densityBins?: number[], weights?: {clarity: number, coverage: number, statistical: number}}): number`
       - Composite scoring function
       - Default weights: clarity 0.4, coverage 0.3, statistical 0.3
       - Returns final 0-100 confidence score
       - Rounds to nearest integer

    Use CrimeRecord type from @/types/crime. Import from existing types - do not redefine.
  </action>
  <verify>
    - Run TypeScript compilation to verify types
    - Check that module exports all four functions
  </verify>
  <done>
    - confidence-scoring.ts exists with calculateConfidence and supporting functions
    - All functions accept CrimeRecord[] and return 0-100 scores
  </done>
</task>

</tasks>

<verification>
- TypeScript compiles without errors
- All functions have proper JSDoc comments
- Functions handle empty data gracefully (return 0 or sensible default)
</verification>

<success_criteria>
Confidence scoring module created with composite scoring (clarity + coverage + statistical), 0-100 range, ready for warp and interval generation to use.
</success_criteria>

<output>
After completion, create `.planning/phases/36-suggestion-generation/36-01-SUMMARY.md`
</output>
