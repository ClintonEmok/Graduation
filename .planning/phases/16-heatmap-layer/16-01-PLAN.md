---
phase: 16-heatmap-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/store/useHeatmapStore.ts, src/components/viz/SliceManagerUI.tsx]
autonomous: true

must_haves:
  truths:
    - "User can toggle heatmap state in the UI"
    - "Heatmap settings (intensity, radius) are accessible and functional"
  artifacts:
    - path: "src/store/useHeatmapStore.ts"
      provides: "Heatmap state management"
    - path: "src/components/viz/SliceManagerUI.tsx"
      provides: "Heatmap toggle and settings in the Layers menu"
---

<objective>
Establish the state management foundation for the Heatmap Layer and add the necessary UI controls to allow users to toggle the feature and adjust its visual properties.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/store/useFeatureFlagsStore.ts
@src/lib/feature-flags.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Heatmap Store</name>
  <files>src/store/useHeatmapStore.ts</files>
  <action>
    Create a new Zustand store to manage heatmap-specific settings:
    - `isEnabled`: boolean (linked to feature flag but also local toggle)
    - `intensity`: number (default 50.0)
    - `radius`: number (default 5.0, world-space units)
    - `opacity`: number (default 0.6)
    - `colorRamp`: string (pre-defined cyan-white monochromatic ramp)
    
    The store should include actions to update these values.
  </action>
  <verify>Store file exists and exports valid useHeatmapStore hook.</verify>
  <done>Store is functional and can be imported by components.</done>
</task>

<task type="auto">
  <name>Task 2: Add Heatmap Controls to UI</name>
  <files>src/components/viz/SliceManagerUI.tsx</files>
  <action>
    Modify the SliceManagerUI (accessible via the 'Layers' icon) to include a Heatmap section:
    - Add a toggle switch to enable/disable the heatmap.
    - Add a slider for 'Heatmap Intensity'.
    - Add a slider for 'Heatmap Radius' (adjusting the `radius` store value).
    - Ensure the heatmap section is only visible if the 'heatmap' feature flag is enabled.
    - Import and use `useHeatmapStore` and `useFeatureFlagsStore`.
  </action>
  <verify>Heatmap toggle, intensity slider, and radius slider appear in the Layers menu when feature flag is on.</verify>
  <done>User can interactively toggle heatmap state and adjust intensity/radius settings.</done>
</task>

</tasks>

<verification>
Check that the heatmap toggle and sliders appear in the Layers panel when the 'heatmap' flag is active in Settings. Verify that intensity and radius changes are reflected in the store.
</verification>

<success_criteria>
1. useHeatmapStore exists and correctly manages intensity, radius, and enabled state.
2. SliceManagerUI displays full heatmap controls when gated by feature flag.
</success_criteria>

<output>
After completion, create `.planning/phases/16-heatmap-layer/16-01-SUMMARY.md`
</output>
