---
phase: 30-timeline-adaptive-time-scaling
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/timeline-test/components/SliceToolbar.tsx
autonomous: true

must_haves:
  truths:
    - "Users can toggle between Linear and Adaptive time scale mode"
    - "Users can adjust warp factor with a slider (0-2 range)"
    - "Current mode is visually indicated with a badge"
  artifacts:
    - path: "src/app/timeline-test/components/SliceToolbar.tsx"
      provides: "Time scale toggle and warp factor controls"
      contains: "timeScaleMode toggle, warpFactor slider, mode badge"
  key_links:
    - from: "SliceToolbar.tsx"
      to: "useTimeStore"
      via: "import and use timeScaleMode, setTimeScaleMode"
    - from: "SliceToolbar.tsx"
      to: "useAdaptiveStore"
      via: "import and use warpFactor, setWarpFactor"
---

<objective>
Add time scale mode toggle and warp factor slider to SliceToolbar in timeline-test.

Purpose: Enable users to switch between linear and adaptive time visualization, matching the main app's functionality. This is a UI-only change - the actual timeline scaling happens in Plan 30-02.

Output: Modified SliceToolbar with toggle button, warp slider, and mode badges.
</objective>

<execution_context>
@~/.opencode/get-shit-done/workflows/execute-plan.md
@~/.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/store/useTimeStore.ts
@src/store/useAdaptiveStore.ts
@src/app/timeline-test/components/SliceToolbar.tsx
@src/components/timeline/TimelinePanel.tsx
@src/components/timeline/AdaptiveControls.tsx
</context>

<tasks>

<task type="auto">
  <name>Add time scale mode toggle and warp factor slider to SliceToolbar</name>
  <files>src/app/timeline-test/components/SliceToolbar.tsx</files>
  <action>
Import useTimeStore and useAdaptiveStore at the top of SliceToolbar.tsx.

Add state subscriptions:
- timeScaleMode and setTimeScaleMode from useTimeStore
- warpFactor and setWarpFactor from useAdaptiveStore

Add a new section after the existing toolbar controls (after the boundary snap controls) containing:
1. A segmented toggle for "Linear | Adaptive" time scale mode - use the same segmented style as the snap mode toggle, with amber active state matching other "active" indicators in the toolbar
2. A warp factor slider with range 0-2 (not 0-1 like main app) per phase requirements, default to 1, showing current value as percentage
3. A badge indicator: gray "Linear" for linear mode, amber "Adaptive" with subtle glow for adaptive mode

The slider should:
- Use the Slider component from @/components/ui/slider
- Range: 0 to 2, step 0.1
- Display value as percentage (0% to 200%)
- Only show slider when in adaptive mode, or always show but disable in linear mode
- Use the same styling as AdaptiveControls from main app

The toggle should:
- Use segmented button style similar to existing snap mode toggle
- Be positioned prominently like the existing controls
- Persist to global store (affects main app too - this is intentional per requirements)
  </action>
  <verify>Build passes with no TypeScript errors. SliceToolbar renders with new controls visible.</verify>
  <done>SliceToolbar shows Linear/Adaptive toggle and warp factor slider. Toggle switches between modes, slider adjusts warp factor from 0-200%.</done>
</task>

</tasks>

<verification>
- Run `npm run build` or `npx tsc --noEmit` to verify no TypeScript errors
- Verify SliceToolbar component renders with new toggle and slider
</verification>

<success_criteria>
- Time scale toggle visible and functional in SliceToolbar
- Warp factor slider visible with 0-2 range
- Mode badge shows current state (Linear gray, Adaptive amber with glow)
- Toggle and slider values persist to stores
</success_criteria>

<output>
After completion, create `.planning/phases/30-timeline-adaptive-time-scaling/30-01-SUMMARY.md`
</output>
